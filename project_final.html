<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="anonymous">

<title>PROJECT</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="project_final_files/libs/clipboard/clipboard.min.js"></script>
<script src="project_final_files/libs/quarto-html/quarto.js"></script>
<script src="project_final_files/libs/quarto-html/popper.min.js"></script>
<script src="project_final_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="project_final_files/libs/quarto-html/anchor.min.js"></script>
<link href="project_final_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="project_final_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="project_final_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="project_final_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="project_final_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-desctription" id="toc-data-desctription" class="nav-link" data-scroll-target="#data-desctription">Data Desctription</a></li>
  <li><a href="#mathematical-model" id="toc-mathematical-model" class="nav-link" data-scroll-target="#mathematical-model">Mathematical Model</a>
  <ul class="collapse">
  <li><a href="#the-generalized-linear-model-and-priors" id="toc-the-generalized-linear-model-and-priors" class="nav-link" data-scroll-target="#the-generalized-linear-model-and-priors">The generalized linear model and priors</a></li>
  <li><a href="#the-generalized-additive-nonlinear-model" id="toc-the-generalized-additive-nonlinear-model" class="nav-link" data-scroll-target="#the-generalized-additive-nonlinear-model">The generalized additive nonlinear model</a></li>
  </ul></li>
  <li><a href="#model-definitions-and-implementation" id="toc-model-definitions-and-implementation" class="nav-link" data-scroll-target="#model-definitions-and-implementation">Model Definitions and Implementation</a>
  <ul class="collapse">
  <li><a href="#linear-model" id="toc-linear-model" class="nav-link" data-scroll-target="#linear-model">Linear model</a></li>
  <li><a href="#nonlinear-model" id="toc-nonlinear-model" class="nav-link" data-scroll-target="#nonlinear-model">Nonlinear model</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model Evaluation</a>
  <ul class="collapse">
  <li><a href="#convergence-diagnostics-posterior-predictive-checks" id="toc-convergence-diagnostics-posterior-predictive-checks" class="nav-link" data-scroll-target="#convergence-diagnostics-posterior-predictive-checks">Convergence diagnostics &amp; posterior predictive checks</a></li>
  <li><a href="#model-comparison-using-loo-cv" id="toc-model-comparison-using-loo-cv" class="nav-link" data-scroll-target="#model-comparison-using-loo-cv">Model comparison using LOO-CV</a></li>
  <li><a href="#posterior-predictive-performance-classification-accuracy" id="toc-posterior-predictive-performance-classification-accuracy" class="nav-link" data-scroll-target="#posterior-predictive-performance-classification-accuracy">Posterior predictive performance: Classification accuracy</a></li>
  <li><a href="#prior-sensitivity-analysis" id="toc-prior-sensitivity-analysis" class="nav-link" data-scroll-target="#prior-sensitivity-analysis">Prior sensitivity analysis</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#lessons-learned" id="toc-lessons-learned" class="nav-link" data-scroll-target="#lessons-learned">Lessons Learned</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="project_final.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">PROJECT</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">BLAL BLA BLA</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>anonymous </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setup
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Install packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"higgi13425/medicaldata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Skipping install of 'medicaldata' from a github remote, the SHA1 (a73901fe) has not changed since last install.
  Use `force = TRUE` to force installation</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(medicaldata)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">library</span>(brms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading 'brms' package (version 2.20.4). Useful instructions
can be found by typing help('brms'). A more detailed introduction
to the package is available through vignette('brms_overview').</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'brms'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    ar</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.92 loaded</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">library</span>(rstanarm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is rstanarm version 2.26.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- For execution on a local, multicore CPU with excess RAM we recommend calling</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  options(mc.cores = parallel::detectCores())</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rstanarm'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:brms':

    dirichlet, exponential, get_y, lasso, ngrps</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">library</span>(loo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is loo version 2.6.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- Online documentation and vignettes at mc-stan.org/loo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- As of v2.0.0 loo defaults to 1 core but we recommend using as many as possible. Use the 'cores' argument or set options(mc.cores = NUM_CORES) for an entire session. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'caret'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:rstanarm':

    compare_models, R2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="fu">library</span>(MASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># library(RColorBrewer)</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="fu">library</span>(knitr)</span>
<span id="cb36-3"><a href="#cb36-3"></a>seed <span class="ot">=</span> <span class="dv">1234</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>cath <span class="ot">&lt;-</span> medicaldata<span class="sc">::</span>cath</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Cardiovascular diseases, particularly coronary artery disease (CAD), remain a leading cause of mortality worldwide. In the pursuit of effective diagnosis and intervention, cardiac catheterization has emerged as a procedure for evaluating and addressing coronary artery health.</p>
<p>A reduction in artery diameter by at least 75% is considered a significant reduction in blood flow that puts downstream heart muscle at risk of ischemia. Such a reduction is defined as significant coronary disease. This report explores the complexities surrounding the cardiac catheterization process, with a specific focus on predicting the presence of significant coronary disease through the utilization of Bayesian models.</p>
<p>Duke University Medical Center’s Cardiovascular Disease Databank provides a data set containing information about patients that has been diagnosed at Duke University Medical Center. The patients where referred to Duke for chest pain and diagnosed accordingly. If the patient was diagnosed with significant coronary disease, the blockade can be of either all three of the coronary vessels, or only of the left main coronary artery. Both conditions are associated with a high risk for mortality.</p>
<p>The scope of this report is to implement two Bayesian models able to predict the probability of significant coronary disease among patients. The two models are based on Bayesian logistic regression, but one is linear and one is non-linear. After implementation the models are evaluated and compared to achieve the best possible result.</p>
<p>In section 2 the data used in this report is described. Section 3 explains the choice of mathematical model used in this report. In section 4 the two Stan models are implemented. Section 5 evaluates and compares the implemented models. Section 6 &amp; 7 includes a final discussion and a reflection on the lessons learned during the project.</p>
</section>
<section id="data-desctription" class="level1">
<h1>Data Desctription</h1>
<p>The “cath” dataset used in this report is obtained from Duke University Cardiovascular Disease Databank. It encapsulates a collection of 6 variables (<span class="citation" data-cites="Data-table">@Data-table</span>) that are closely related to cardiovascular health.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>TBD </caption>
<thead>
<tr class="header">
<th style="text-align: right;">sex</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">cad_dur</th>
<th style="text-align: right;">choleste</th>
<th style="text-align: right;">sigdz</th>
<th style="text-align: right;">tvdlm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">132</td>
<td style="text-align: right;">268</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">269</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The dataset consists of four explanatory variables (<em>sex</em>, <em>age</em>, <em>cad_dur</em>, <em>choleste</em>) and two response variables (<em>sigdz</em>, <em>tvdlm</em>) that provide an overview on patient demographics, clinical indicators, and critical outcomes related to coronary artery disease:</p>
<ul>
<li><p><strong>Sex</strong> (<em>sex</em>): Categorized as 0 for male and 1 for female, this variable represents the gender distribution within our dataset.</p></li>
<li><p><strong>Age</strong> (<em>age</em>): Representing the age of patients in years, this variable serves as a demographic feature.</p></li>
<li><p><strong>Chest Pain Duration</strong> (<em>cad_dur</em>): The duration of chest pain symptoms in days.</p></li>
<li><p><strong>Serum Cholesterol Level</strong> (<em>choleste</em>): Measured in milligrams per deciliter, serum cholesterol levels are indicative of lipid metabolism and play a crucial role in cardiovascular health.</p></li>
<li><p><strong>Significant Coronary Disease</strong> (<em>sigdz</em>): A binary variable that captures the presence (1) or absence (0) of at least 75% blockage in one of the major coronary arteries.</p></li>
<li><p><strong>Three Vessel Disease or Left Main Disease</strong> (<em>tvdlm</em>): Denoting the presence (1) or absence (0) of blockage in either all three coronary vessels or in the left main coronary artery.</p></li>
</ul>
<p>The univariate distributions of these variables are visualized in <span class="citation" data-cites="Univariate-analysis">@Univariate-analysis</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="project_final_files/figure-html/Univariate-analysis-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">TBD 1</figcaption>
</figure>
</div>
</div>
</div>
<p>While constructing the Bayesian models to predict the probaility of significant coronary disease, the report strives to utilize the correlation between the explanatory variables (<em>sex</em>, <em>age</em>, <em>cad_dur</em>, <em>choleste</em>) and the desired response variable (<em>sigdz</em>). The <em>tvdlm</em> variable is not relevant in this report as the main focus is to predict the probability of significant coronary disease, independent of the type of the blockade.</p>
<p>Before the analysis, the data is preprocessed by removing <em>tvdlm</em> column and all rows that contain missing values, as well as by scaling the continuous variables to zero mean and unit variance. After this, we are left with <span class="math inline">\(n =\)</span> 2258 observations. The pairwise correlations of variables are visualized in <span class="citation" data-cites="Bivariate-analysis">@Bivariate-analysis</span>. We can see that variables <em>sex</em> and <em>age</em> have the most significant bivariate correlation to the responsive variable <em>sigdz</em>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="project_final_files/figure-html/Bivariate-analysis-1.png" class="img-fluid figure-img" width="288"></p>
<figcaption class="figure-caption">TBD 3</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mathematical-model" class="level1">
<h1>Mathematical Model</h1>
<p>In this analysis, we will construct two models for inferring the binary response variable, <em>sigdz</em> based on input explanatory variables<em>.</em> The first model is a generalized linear model (GLM), namely Bayesian logistic regression. The other model is a generalized additive mixed model (GAMM), which implements Bayesian logistic regression with nonlinear transformations on the input variables. These models will be referred as linear and nonlinear model, respectively.</p>
<p>(((To-be-done still: - Check likelihood notation for nonlinear model - Prior justification - Check prior notations - Include priors with own values ? - <strong>Posteriors</strong> ?)))</p>
<section id="the-generalized-linear-model-and-priors" class="level2">
<h2 class="anchored" data-anchor-id="the-generalized-linear-model-and-priors">The generalized linear model and priors</h2>
<p>Let <span class="math inline">\(y\)</span> be the number of times the variable <em>sigdz</em> is realized to be 1 for one individual in the dataset, and let <span class="math inline">\(x\)</span> be the explanatory variables for this outcome. Then, this number of successes for one individual follows a Binomial distribution</p>
<p><span class="math display">\[
y \sim \binom{n}{y}\theta^y(1-\theta)^{n-y},
\]</span></p>
<p>where n is the number of observations for that specific individual and <span class="math inline">\(\theta = g^{-1}(\eta)\)</span> <span class="math inline">\((\eta = \alpha + x^{T} \beta)\)</span> is the probability of success (patient presenting with significant coronary disease). The inverse link function <span class="math inline">\(g^{-1}\)</span> maps the output of the linear predictor <span class="math inline">\(\eta\)</span> to a probability interval between 0 and 1.</p>
<p>For the binomial GLM, this project utilizes logit <span class="math inline">\(g(x) = \ln(\frac{x}{1-x})\)</span> as a link function, which makes it a logistic regression model. As each individual occurs only once in the data, <span class="math inline">\(y\)</span> can be directly presented as the binary response variable. Therefore, the likelihood of the response variable of one individual is reduced to Bernoulli distribution</p>
<p><span class="math display">\[
y \sim \text{ logit}^{-1}(\eta)^y(1-\text{ logit}^{-1}(\eta))^{1-y}.
\]</span></p>
<p>The complete data likelihood is then a product of <span class="math inline">\(n =\)</span> 2258 likelihoods, with unshared probability of success.</p>
<p>As in Bayesian logistic regression the scope is to infer the distribution of the regression weights, namely the intercept <span class="math inline">\(\alpha\)</span> and coefficients <span class="math inline">\(\beta = [\beta_1, \beta_2, \beta_3, \beta_4]^T\)</span>, we define the prior to be Student’s <span class="math inline">\(t\)</span>-distribution</p>
<p><span class="math display">\[
\begin{aligned}
\alpha &amp;\sim t_v(\mu, \sigma) \\
\beta_k &amp;\sim t_v(\mu, \sigma), \ k=1,..,4 \\
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(v\)</span> is the degrees of freedom, <span class="math inline">\(\mu\)</span> is the location and <span class="math inline">\(\sigma\)</span> is the scale.</p>
<p>The selection of prior distribution was done based on the nature of the data. Due to correlations, there is reason to believe that the parameters are not very close to zero, but most are still rather small than large. Therefore, as Student’s <span class="math inline">\(t\)</span>-distribution has heavy tails and larger scale compared to, for example, Gaussian distribution, <span class="math inline">\(t\)</span>-distribution is a suitable choice of prior for this purpose. The parameters of the prior were defined to be</p>
<p><span class="math display">\[
v = 3, \quad \mu = 0, \quad \sigma = 2.5,
\]</span></p>
<p>as the coefficients can be positive or negative.</p>
<p>Finally, the joint posterior distribution that is simulated using Hamiltonian Monte Carlo (HMC) is proportional to the product of likelihood and prior distributions:</p>
<p><span class="math display">\[
p(\alpha, \beta | \textbf{x}, \textbf{y} ) \propto t_v(\alpha | \mu, \sigma) \times \prod^4_{k=1} t_v(\beta_k | \mu, \sigma) \times \prod^n_{i=1} \text{ logit}^{-1}(\eta_i)^{y_i}(1-\text{ logit}^{-1}(\eta_i))^{1-y_i}
\]</span></p>
</section>
<section id="the-generalized-additive-nonlinear-model" class="level2">
<h2 class="anchored" data-anchor-id="the-generalized-additive-nonlinear-model">The generalized additive nonlinear model</h2>
<p>The additive nonlinear model on the other hand, is a generalized additive mixed model which combines multiple functions in a way that is not strictly linear. This allows for a more flexible relationship between the explanatory variables and response variable <span class="math inline">\(y\)</span>. In this report, the nonlinear model uses the same link function as the linear model, and so the nonlinear predictor for the logistic regression model can be written as:</p>
<p><span class="math display">\[
\text{logit} (\theta) = \eta = \alpha + \sum^4_{k=1} \beta_k f_k(x_k),
\]</span></p>
<p>where <span class="math inline">\(f_k\)</span> are nonlinear functions that transform the explanatory features individually. In this report, all functions of the continuous variables are smoothing functions. The <span class="math inline">\(f_{age}\)</span> is simply the variable itself, due to <em>sex</em> being binary variable. The smoothing functions utilize penalized splines, allowing the model to create a curved relationship between the features. The shape of the smoothing functions is estimated from the data and the penalty helps avoid overfitting. The smoothing function works by minimizing the sum of the model fit with the smoothness / penalty (here, thin plate regression splines (default)).</p>
<p>The likelihood of observation is the same as with the linear model, with the difference that a nonlinear transformation is applied to all input explanatory variables <span class="math inline">\(\textbf{x}\)</span>. Additionally, we utilize the same prior in both models to make them as comparable as possible. The posterior is again similar as with the linear model, but with the difference of nonlinear transformations on the input data.</p>
</section>
</section>
<section id="model-definitions-and-implementation" class="level1">
<h1>Model Definitions and Implementation</h1>
<p>The linear and nonlinear models are implemented as Stan code with the rstanarm package as described below. Both models were implemented with identical number of chains, draws and warm-up. The default values (chains = 4, draws = 4000, and warmup = 2000) were used in both cases.</p>
<section id="linear-model" class="level2">
<h2 class="anchored" data-anchor-id="linear-model">Linear model</h2>
<p>The linear model was implemented with the help of the <code>stan_glm</code> function from the rstanarm package. <code>stan_glm</code> is used to fit generalized linear models and performs a full Bayesian estimation with Markov Chain Monte Carlo (MCMC) estimation instead of maximum likelihood estimation and by adding priors to the GLM coefficients and intercept. By defining the model parameter <code>family = binomial(link = 'logit')</code> the model performs logistic regression.</p>
<p>The linear relationship between the response variable <code>sigdz</code> and the explanatory variables are defined with the help of the <code>formula</code> function and the prior for the regression coefficients and intercept with the help of the <code>student_t</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># Make response variable a factor</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>cath<span class="sc">$</span>sigdz <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(cath<span class="sc">$</span>sigdz)</span>
<span id="cb38-3"><a href="#cb38-3"></a>y <span class="ot">&lt;-</span> cath<span class="sc">$</span>sigdz</span>
<span id="cb38-4"><a href="#cb38-4"></a></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="co"># Formula</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>formula_linear <span class="ot">&lt;-</span> <span class="fu">formula</span>(sigdz <span class="sc">~</span> sex <span class="sc">+</span> age <span class="sc">+</span> cad_dur <span class="sc">+</span> choleste)</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="co"># Prior</span></span>
<span id="cb38-9"><a href="#cb38-9"></a>prior_linear <span class="ot">&lt;-</span> <span class="fu">student_t</span>(<span class="at">df =</span> <span class="dv">3</span>, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>)</span>
<span id="cb38-10"><a href="#cb38-10"></a></span>
<span id="cb38-11"><a href="#cb38-11"></a><span class="co"># The model</span></span>
<span id="cb38-12"><a href="#cb38-12"></a>model_linear <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb38-13"><a href="#cb38-13"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), </span>
<span id="cb38-14"><a href="#cb38-14"></a>                <span class="at">prior =</span> prior_linear, <span class="at">prior_intercept =</span> prior_linear,</span>
<span id="cb38-15"><a href="#cb38-15"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb38-16"><a href="#cb38-16"></a></span>
<span id="cb38-17"><a href="#cb38-17"></a><span class="co"># saveRDS(model_linear, file = "./additional_files/model_linear.rds")</span></span>
<span id="cb38-18"><a href="#cb38-18"></a><span class="co"># model_linear &lt;- readRDS("./additional_files/model_linear.rds")                </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="nonlinear-model" class="level2">
<h2 class="anchored" data-anchor-id="nonlinear-model">Nonlinear model</h2>
<p>The nonlinear model is similarly implemented utilizing <code>stan_gamm4</code> function from the rstanarm package and defined to be a logistic regression model with the help of the model parameter <code>family = binomial(link = 'logit')</code>. <code>stan_gamm4</code> fits a generalized additive mixed model, and performs Bayesian MCMC estimation instead of maximum likelihood estimation. In the same way as <code>stan_glm</code>, the model adds independent priors to the regression coefficients and intercept.</p>
<p>The nonlinear relationship between the response variable <code>sigdz</code> and the explanatory variables is again defined with the help of the <code>formula</code> function. This time, passing the smoothing function <code>s()</code> for all continuous explanatory variables, to allow for more complexity in the model, while simultaneously penalizing over-fitting of the model with the the thin plate regression splines smoothness.</p>
<p>The same priors are used as for the linear model for both the intercept and the regression coefficients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Formula</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>formula_nonlinear <span class="ot">&lt;-</span> <span class="fu">formula</span>(sigdz <span class="sc">~</span> sex <span class="sc">+</span> <span class="fu">s</span>(age) <span class="sc">+</span> <span class="fu">s</span>(cad_dur) <span class="sc">+</span> <span class="fu">s</span>(choleste))</span>
<span id="cb39-3"><a href="#cb39-3"></a></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="co"># Model definition</span></span>
<span id="cb39-5"><a href="#cb39-5"></a>model_nonlinear <span class="ot">&lt;-</span> <span class="fu">stan_gamm4</span>(</span>
<span id="cb39-6"><a href="#cb39-6"></a>  formula_nonlinear, <span class="at">data =</span> cath,</span>
<span id="cb39-7"><a href="#cb39-7"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb39-8"><a href="#cb39-8"></a>  <span class="at">prior =</span> prior_linear, <span class="at">prior_intercept =</span> prior_linear,</span>
<span id="cb39-9"><a href="#cb39-9"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb39-10"><a href="#cb39-10"></a>)</span>
<span id="cb39-11"><a href="#cb39-11"></a></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="co"># saveRDS(model_nonlinear, file = "./additional_files/model_nonlinear.rds")</span></span>
<span id="cb39-13"><a href="#cb39-13"></a><span class="co"># model_nonlinear &lt;- readRDS("./additional_files/model_nonlinear.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-evaluation" class="level1">
<h1>Model Evaluation</h1>
<p>After fitting the models, multiple evaluation metrics such as split-<span class="math inline">\(\hat{R}\)</span>, effective sample size (ESS) and number of divergent transitions were used to assess the convergence of MCMC chains separately for each model. Additionally, we perform posterior predictive checks, assess the model performances as well as compare the models utilizing leave-one-out cross validation (LOO-CV). Finally, we perform prior sensitivity analysis for both models.</p>
<ul>
<li>Rhat, ESS, HMC divergences, pp_check(), loo_compare(), classification accuracy</li>
<li>Prior sensitivity analysis</li>
</ul>
<section id="convergence-diagnostics-posterior-predictive-checks" class="level2">
<h2 class="anchored" data-anchor-id="convergence-diagnostics-posterior-predictive-checks">Convergence diagnostics &amp; posterior predictive checks</h2>
<p>For the linear model, the posterior predictive check and posterior distributions of the parameters with 95 % credible interval are visualized in <span class="citation" data-cites="linear-model-pp-check">@linear-model-pp-check</span>. As we can see, the model fits the data relatively well, with a bit of a variation around the probability interval endpoints.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="project_final_files/figure-html/linear-model-pp-check-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">TBD</figcaption>
</figure>
</div>
</div>
</div>
<p>The convergence diagnostics for the linear model are summarized below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Split-Rhat:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)           sex           age       cad_dur      choleste 
        1.001         1.000         0.999         1.000         1.000 
     mean_PPD log-posterior 
        1.000         1.001 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of divergent transitions:  0 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>ESS ratio: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         sex         age     cad_dur    choleste 
    1.24450     1.17625     1.31075     1.33050     1.32150 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Sd of ESS ratio:  0.066</code></pre>
</div>
</div>
<p>The HMC chains have converged, as all split-<span class="math inline">\(\hat{R}\)</span> values are below 0.01. Additionally, there were no divergent transitions during convergence, and thus the HMC simulation is reliable. The ratio of the ESS to the true sample size is over 1 with all explanatory variables as well as the intercept. Although high ESS is generally a good thing, this also implies the MCMC samples may have a negative correlation.</p>
<p>For the nonlinear model, the posterior predictive check is visualized in <span class="citation" data-cites="nonlinear-model-pp-check">@nonlinear-model-pp-check</span>. Based on visual inspection, the nonlinear model fits the data as well as the linear model. Like with the linear model, the posterior has a bit of a variation around the probability interval endpoints.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="project_final_files/figure-html/nonlinear-model-pp-check-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">TBD</figcaption>
</figure>
</div>
</div>
</div>
<p>The convergence diagnostics for the nonlinear model are summarized below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Split-Rhat of the first coefficients:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         sex    s(age).1    s(age).2    s(age).3    s(age).4 
      0.999       0.999       1.000       1.000       1.001       1.000 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>All split-Rhat &lt;= 0.01:  TRUE </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of divergent transitions:  1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>ESS ratio of the first coefficients: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         sex    s(age).1    s(age).2    s(age).3    s(age).4 
      1.414       1.447       1.022       1.038       0.464       1.008 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean of ESS ratio:  0.936</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Sd of ESS ratio:  0.383</code></pre>
</div>
</div>
<p>Also the MCMC chains for this model have converged, as the split-<span class="math inline">\(\hat{R}\)</span> is less than 0.01 for all coefficients. As with the linear model, there were no divergent transitions during convergence, and thus the HMC simulation is reliable. On the other hand, the ESS ratio is on average less than 1, so a bit lower than with the linear model. However, the standard deviation of the ESS ratios is over twice larger than with the linear model. Low ESS ratio is not good in the model sense, but nevertheless the nonlinear has multiple coefficients to balance out the overall effect.</p>
</section>
<section id="model-comparison-using-loo-cv" class="level2">
<h2 class="anchored" data-anchor-id="model-comparison-using-loo-cv">Model comparison using LOO-CV</h2>
<p>To compare the performance of the linear model and nonlinear model to each other as well as to a baseline model, we will compute the expected log-densities of the predictive distributions (ELPD) by applying Pareto smoothed LOO-CV (PSIS-LOO) to the models. The baseline model is simply a logistic regression model without any explanatory variables and with a unit coefficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Baseline model</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>model_baseline <span class="ot">&lt;-</span> <span class="fu">update</span>(model_linear, <span class="at">formula =</span> sigdz <span class="sc">~</span> <span class="dv">1</span>, <span class="at">QR =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results of the PSIS-LOO for each model are presented below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Linear model:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 2258 log-likelihood matrix

         Estimate   SE
elpd_loo  -1177.4 24.4
p_loo         5.1  0.2
looic      2354.7 48.8
------
Monte Carlo SE of elpd_loo is 0.0.

All Pareto k estimates are good (k &lt; 0.5).
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Nonlinear model:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 2258 log-likelihood matrix

         Estimate   SE
elpd_loo  -1170.5 24.3
p_loo        11.5  0.7
looic      2340.9 48.7
------
Monte Carlo SE of elpd_loo is 0.1.

Pareto k diagnostic values:
                         Count Pct.    Min. n_eff
(-Inf, 0.5]   (good)     2257  100.0%  1513      
 (0.5, 0.7]   (ok)          1    0.0%  2146      
   (0.7, 1]   (bad)         0    0.0%  &lt;NA&gt;      
   (1, Inf)   (very bad)    0    0.0%  &lt;NA&gt;      

All Pareto k estimates are ok (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Baseline model:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 2258 log-likelihood matrix

         Estimate   SE
elpd_loo  -1448.7 14.9
p_loo         1.0  0.0
looic      2897.3 29.9
------
Monte Carlo SE of elpd_loo is 0.0.

All Pareto k estimates are good (k &lt; 0.5).
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
</div>
<p>For each model, all Pareto k estimates are &lt; 0.5, which implies the importance sampling gives a reliable estimate on the computed ELPDs. Additionally, for linear and nonlinear model the p_loo is less than the number of parameters in the respective model, and thus the model specifications seem to be reasonable.</p>
<p>To assess the model ELPDs with respect to each other, we compute the comparison between the results of PSIS-LOO:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                elpd_diff se_diff
model_nonlinear    0.0       0.0 
model_linear      -6.9       3.4 
model_baseline  -278.2      21.8 </code></pre>
</div>
</div>
<p>It indeed seems that the predictive performances of both linear and nonlinear models are better compared to the baseline model. Additionally, the scale of the difference of standard errors (se_diff) of the baseline model and nonlinear model is smaller than the difference of the ELPDs of the nonlinear and baseline model, which implies the difference in predictive log-densities between these models is not simply explained by the variance. Although the difference in ELPDs of the linear and nonlinear models is small, the nonlinear model slightly outperforms the linear model.</p>
</section>
<section id="posterior-predictive-performance-classification-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="posterior-predictive-performance-classification-accuracy">Posterior predictive performance: Classification accuracy</h2>
<p>To estimate the generalization error, i.e.&nbsp;the generalization and performance of models on unseen data, we compute LOO-balanced classification accuracies for the linear and nonlinear models. The results are summarized in <span class="citation" data-cites="Classification-accuracies">@Classification-accuracies</span>. The classification accuracy is simply the fraction of correctly classified observations. The balanced classification accuracy on the other hand takes into account true positive rate (sensitivity) and true negative rate (specificity). The latter accounts for the imbalance in our data and is therefore more accurate estimate on the generalization error. Estimating generalization error is highly important for practical usage of the model, as it would be centered around predicting</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>TBD </caption>
<colgroup>
<col style="width: 21%">
<col style="width: 32%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">classification_accuracy</th>
<th style="text-align: right;">balanced_classification_accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">linear_model</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">0.69</td>
</tr>
<tr class="even">
<td style="text-align: left;">nonlinear_model</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0.69</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can see that the performances of both models are nearly equal. The classification accuracy is slightly better for the nonlinear model, but the balanced accuracy is the same for both models. The the balanced classification accuracy is not very high, but nevertheless, both models outperform a random classifier.</p>
<p>To further compare the predictive performances of the models, calibration plots of both linear and nonlinear models are visualized in <span class="citation" data-cites="Calibration-plots">@Calibration-plots</span>. From these plots we can see that both models are calibrated on approximately the interval of [0.25, 0.5] of predicted probabilities. For the top 10% there are more predictions than observations, and for the bottom 20% there are more observations than predictions.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="project_final_files/figure-html/Calibration-plots-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">TBD X</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="prior-sensitivity-analysis" class="level2">
<h2 class="anchored" data-anchor-id="prior-sensitivity-analysis">Prior sensitivity analysis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co">#normal prior</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>normal_prior <span class="ot">&lt;-</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="cn">NULL</span>, <span class="at">autoscale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-3"><a href="#cb62-3"></a>linear_model_normal_prior <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb62-4"><a href="#cb62-4"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb62-5"><a href="#cb62-5"></a>                <span class="at">prior =</span> normal_prior, <span class="at">prior_intercept =</span> normal_prior,</span>
<span id="cb62-6"><a href="#cb62-6"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb62-7"><a href="#cb62-7"></a></span>
<span id="cb62-8"><a href="#cb62-8"></a><span class="co">#default prior</span></span>
<span id="cb62-9"><a href="#cb62-9"></a>linear_model_default_prior <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb62-10"><a href="#cb62-10"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb62-11"><a href="#cb62-11"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb62-12"><a href="#cb62-12"></a></span>
<span id="cb62-13"><a href="#cb62-13"></a><span class="co">#cauchy prior</span></span>
<span id="cb62-14"><a href="#cb62-14"></a>cauchy_prior <span class="ot">&lt;-</span> <span class="fu">cauchy</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="cn">NULL</span>, <span class="at">autoscale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-15"><a href="#cb62-15"></a>linear_model_cauchy_prior <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb62-16"><a href="#cb62-16"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb62-17"><a href="#cb62-17"></a>                <span class="at">prior =</span> cauchy_prior, <span class="at">prior_intercept =</span> cauchy_prior,</span>
<span id="cb62-18"><a href="#cb62-18"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb62-19"><a href="#cb62-19"></a></span>
<span id="cb62-20"><a href="#cb62-20"></a><span class="co">#normal prior, large scale N(0, 100)</span></span>
<span id="cb62-21"><a href="#cb62-21"></a>normal_prior_sd <span class="ot">&lt;-</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">100</span>, <span class="at">autoscale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-22"><a href="#cb62-22"></a>linear_model_normal_sd <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb62-23"><a href="#cb62-23"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb62-24"><a href="#cb62-24"></a>                <span class="at">prior =</span> normal_prior_sd, <span class="at">prior_intercept =</span> normal_prior_sd,</span>
<span id="cb62-25"><a href="#cb62-25"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb62-26"><a href="#cb62-26"></a></span>
<span id="cb62-27"><a href="#cb62-27"></a><span class="co">#normal prior, large location</span></span>
<span id="cb62-28"><a href="#cb62-28"></a>normal_prior_loc <span class="ot">&lt;-</span> <span class="fu">normal</span>(<span class="dv">100</span>, <span class="at">scale =</span> <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-29"><a href="#cb62-29"></a>linear_model_normal_loc <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb62-30"><a href="#cb62-30"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb62-31"><a href="#cb62-31"></a>                <span class="at">prior =</span> normal_prior_loc, <span class="at">prior_intercept =</span> normal_prior_loc,</span>
<span id="cb62-32"><a href="#cb62-32"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb62-33"><a href="#cb62-33"></a></span>
<span id="cb62-34"><a href="#cb62-34"></a><span class="co">#flat prior</span></span>
<span id="cb62-35"><a href="#cb62-35"></a>flat_prior <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-36"><a href="#cb62-36"></a>linear_model_flat_prior <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb62-37"><a href="#cb62-37"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb62-38"><a href="#cb62-38"></a>                <span class="at">prior =</span> flat_prior, <span class="at">prior_intercept =</span> flat_prior,</span>
<span id="cb62-39"><a href="#cb62-39"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting the posterior distribution for each prior:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>pplot_normal <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_normal_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Normal prior"</span>)</span>
<span id="cb63-3"><a href="#cb63-3"></a></span>
<span id="cb63-4"><a href="#cb63-4"></a>pplot_default <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_default_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Default prior"</span>)</span>
<span id="cb63-6"><a href="#cb63-6"></a></span>
<span id="cb63-7"><a href="#cb63-7"></a>pplot_cauchy <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_cauchy_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cauchy prior"</span>)</span>
<span id="cb63-9"><a href="#cb63-9"></a></span>
<span id="cb63-10"><a href="#cb63-10"></a><span class="co"># pplot_linear &lt;- pplot_linear + geom_vline(xintercept = 0) + labs(title = "Model prior")</span></span>
<span id="cb63-11"><a href="#cb63-11"></a></span>
<span id="cb63-12"><a href="#cb63-12"></a>pplot_normal_sd <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_normal_sd, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb63-13"><a href="#cb63-13"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"N(0, 100)"</span>)</span>
<span id="cb63-14"><a href="#cb63-14"></a></span>
<span id="cb63-15"><a href="#cb63-15"></a>pplot_normal_loc <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_normal_loc, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb63-16"><a href="#cb63-16"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"N(100, 0)"</span>)</span>
<span id="cb63-17"><a href="#cb63-17"></a></span>
<span id="cb63-18"><a href="#cb63-18"></a>pplot_flat <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_flat_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb63-19"><a href="#cb63-19"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"flat prior"</span>)</span>
<span id="cb63-20"><a href="#cb63-20"></a></span>
<span id="cb63-21"><a href="#cb63-21"></a><span class="co">#put desired priors into here</span></span>
<span id="cb63-22"><a href="#cb63-22"></a><span class="fu">grid.arrange</span>(pplot_normal_sd, pplot_normal_loc, pplot_default, pplot_flat, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="project_final_files/figure-html/Linear%20model%20-%20Plotting%20prior%20sensititvy-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co">#normal prior</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>nonlinear_model_normal_prior <span class="ot">&lt;-</span> <span class="fu">stan_gamm4</span>(</span>
<span id="cb64-3"><a href="#cb64-3"></a>  formula_nonlinear, <span class="at">data =</span> cath,</span>
<span id="cb64-4"><a href="#cb64-4"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb64-5"><a href="#cb64-5"></a>  <span class="at">prior =</span> normal_prior, <span class="at">prior_intercept =</span> normal_prior,</span>
<span id="cb64-6"><a href="#cb64-6"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb64-7"><a href="#cb64-7"></a>)</span>
<span id="cb64-8"><a href="#cb64-8"></a></span>
<span id="cb64-9"><a href="#cb64-9"></a><span class="co">#default prior</span></span>
<span id="cb64-10"><a href="#cb64-10"></a>nonlinear_model_default_prior <span class="ot">&lt;-</span> <span class="fu">stan_gamm4</span>(</span>
<span id="cb64-11"><a href="#cb64-11"></a>  formula_nonlinear, <span class="at">data =</span> cath,</span>
<span id="cb64-12"><a href="#cb64-12"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb64-13"><a href="#cb64-13"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb64-14"><a href="#cb64-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co">#cauchy prior</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>nonlinear_model_cauchy_prior <span class="ot">&lt;-</span> <span class="fu">stan_gamm4</span>(</span>
<span id="cb67-3"><a href="#cb67-3"></a>  formula_nonlinear, <span class="at">data =</span> cath,</span>
<span id="cb67-4"><a href="#cb67-4"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb67-5"><a href="#cb67-5"></a>  <span class="at">prior =</span> cauchy_prior, <span class="at">prior_intercept =</span> cauchy_prior,</span>
<span id="cb67-6"><a href="#cb67-6"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb67-7"><a href="#cb67-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>nonlinear_pplot_normal <span class="ot">&lt;-</span> <span class="fu">plot</span>(nonlinear_model_normal_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Normal prior"</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a></span>
<span id="cb68-4"><a href="#cb68-4"></a>nonlinear_pplot_default <span class="ot">&lt;-</span> <span class="fu">plot</span>(nonlinear_model_default_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Default prior"</span>)</span>
<span id="cb68-6"><a href="#cb68-6"></a></span>
<span id="cb68-7"><a href="#cb68-7"></a>nonlinear_pplot_cauchy <span class="ot">&lt;-</span> <span class="fu">plot</span>(nonlinear_model_cauchy_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cauchy prior"</span>)</span>
<span id="cb68-9"><a href="#cb68-9"></a></span>
<span id="cb68-10"><a href="#cb68-10"></a>pplot_nonlinear <span class="ot">&lt;-</span> <span class="fu">plot</span>(model_nonlinear, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb68-11"><a href="#cb68-11"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model prior"</span>)</span>
<span id="cb68-12"><a href="#cb68-12"></a></span>
<span id="cb68-13"><a href="#cb68-13"></a><span class="fu">grid.arrange</span>(pplot_nonlinear, nonlinear_pplot_normal, nonlinear_pplot_default, nonlinear_pplot_cauchy, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="project_final_files/figure-html/Nonlinear%20model%20-%20Plotting%20prior%20sensititivy-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>The scope of this report was to implement two Bayesian models able to predict the probability of significant coronary disease among patients. The models were implemented Bayesian logistic regression with both a linear and a non-linear approach. The results were two Stan models of equal classification accuracy.</p>
<p>With classification accuracies of 0.75 (linear) and 0.76 (non-linear), both models performed adequately when it came to predicting the pervalance of significant coronary disease. The results indicate that both models outperform the baseline model, with the nonlinear model slightly surpassing the linear model in terms of predictive performance.</p>
<p>There is still room for improvement when it comes to the predictive performance of the models. The problem here may lie in the explanatory variables being to general when it comes to predicting a certain diseases. To further improve the predictive performance of the model, new explanatory variables may have to be introduced. Family history, blood pressure, and smoking status are all possible explanatory variables closely related to cardiovascular health that could help improve model performance.</p>
<p>In conclusion,</p>
</section>
<section id="lessons-learned" class="level1">
<h1>Lessons Learned</h1>
</section>
<section id="references" class="level1">
<h1>References</h1>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb69" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb69-1"><a href="#cb69-1"></a><span class="co">---</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="an">title:</span><span class="co"> "PROJECT"</span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="an">subtitle:</span><span class="co"> "BLAL BLA BLA"</span></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="an">author:</span><span class="co"> anonymous</span></span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="an">format:</span></span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="co">  html:</span></span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="co">    toc: true</span></span>
<span id="cb69-8"><a href="#cb69-8"></a><span class="co">    code-tools: true</span></span>
<span id="cb69-9"><a href="#cb69-9"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb69-10"><a href="#cb69-10"></a><span class="co">    msainfont: Georgia, serif</span></span>
<span id="cb69-11"><a href="#cb69-11"></a><span class="co">    page-layout: article</span></span>
<span id="cb69-12"><a href="#cb69-12"></a><span class="co">  pdf:  </span></span>
<span id="cb69-13"><a href="#cb69-13"></a><span class="co">    number-sections: true</span></span>
<span id="cb69-14"><a href="#cb69-14"></a><span class="co">    code-annotations: none</span></span>
<span id="cb69-15"><a href="#cb69-15"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb69-16"><a href="#cb69-16"></a><span class="co">---</span></span>
<span id="cb69-17"><a href="#cb69-17"></a></span>
<span id="cb69-18"><a href="#cb69-18"></a>::: {.content-hidden when-format="pdf"}</span>
<span id="cb69-19"><a href="#cb69-19"></a>::: {.callout-warning collapse="false"}</span>
<span id="cb69-20"><a href="#cb69-20"></a><span class="fu">## Setup</span></span>
<span id="cb69-21"><a href="#cb69-21"></a></span>
<span id="cb69-22"><a href="#cb69-22"></a>Install packages:</span>
<span id="cb69-23"><a href="#cb69-23"></a></span>
<span id="cb69-26"><a href="#cb69-26"></a><span class="in">```{r}</span></span>
<span id="cb69-27"><a href="#cb69-27"></a><span class="co">#| label: Setup</span></span>
<span id="cb69-28"><a href="#cb69-28"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"higgi13425/medicaldata"</span>)</span>
<span id="cb69-29"><a href="#cb69-29"></a><span class="fu">library</span>(medicaldata)</span>
<span id="cb69-30"><a href="#cb69-30"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb69-31"><a href="#cb69-31"></a><span class="fu">library</span>(brms)</span>
<span id="cb69-32"><a href="#cb69-32"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb69-33"><a href="#cb69-33"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb69-34"><a href="#cb69-34"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb69-35"><a href="#cb69-35"></a><span class="fu">library</span>(loo)</span>
<span id="cb69-36"><a href="#cb69-36"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb69-37"><a href="#cb69-37"></a><span class="fu">library</span>(caret)</span>
<span id="cb69-38"><a href="#cb69-38"></a><span class="fu">library</span>(splines)</span>
<span id="cb69-39"><a href="#cb69-39"></a><span class="fu">library</span>(MASS)</span>
<span id="cb69-40"><a href="#cb69-40"></a><span class="co"># library(RColorBrewer)</span></span>
<span id="cb69-41"><a href="#cb69-41"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb69-42"><a href="#cb69-42"></a><span class="fu">library</span>(grid)</span>
<span id="cb69-43"><a href="#cb69-43"></a><span class="fu">library</span>(knitr)</span>
<span id="cb69-44"><a href="#cb69-44"></a>seed <span class="ot">=</span> <span class="dv">1234</span></span>
<span id="cb69-45"><a href="#cb69-45"></a><span class="in">```</span></span>
<span id="cb69-46"><a href="#cb69-46"></a></span>
<span id="cb69-47"><a href="#cb69-47"></a>Import the data:</span>
<span id="cb69-48"><a href="#cb69-48"></a></span>
<span id="cb69-51"><a href="#cb69-51"></a><span class="in">```{r}</span></span>
<span id="cb69-52"><a href="#cb69-52"></a><span class="co">#| label: Importing-data</span></span>
<span id="cb69-53"><a href="#cb69-53"></a>cath <span class="ot">&lt;-</span> medicaldata<span class="sc">::</span>cath</span>
<span id="cb69-54"><a href="#cb69-54"></a><span class="in">```</span></span>
<span id="cb69-55"><a href="#cb69-55"></a>:::</span>
<span id="cb69-56"><a href="#cb69-56"></a>:::</span>
<span id="cb69-57"><a href="#cb69-57"></a></span>
<span id="cb69-58"><a href="#cb69-58"></a><span class="fu"># Introduction</span></span>
<span id="cb69-59"><a href="#cb69-59"></a></span>
<span id="cb69-60"><a href="#cb69-60"></a>Cardiovascular diseases, particularly coronary artery disease (CAD), remain a leading cause of mortality worldwide. In the </span>
<span id="cb69-61"><a href="#cb69-61"></a>pursuit of effective diagnosis and intervention, cardiac catheterization has emerged as a procedure for evaluating and </span>
<span id="cb69-62"><a href="#cb69-62"></a>addressing coronary artery health. </span>
<span id="cb69-63"><a href="#cb69-63"></a></span>
<span id="cb69-64"><a href="#cb69-64"></a>A reduction in artery diameter by at least 75% is considered a significant reduction in blood flow that puts downstream </span>
<span id="cb69-65"><a href="#cb69-65"></a>heart muscle at risk of ischemia. Such a reduction is defined as significant coronary disease.</span>
<span id="cb69-66"><a href="#cb69-66"></a>This report explores the complexities surrounding the cardiac catheterization process, with a specific focus on </span>
<span id="cb69-67"><a href="#cb69-67"></a>predicting the presence of significant coronary disease through the utilization of </span>
<span id="cb69-68"><a href="#cb69-68"></a>Bayesian models.</span>
<span id="cb69-69"><a href="#cb69-69"></a></span>
<span id="cb69-70"><a href="#cb69-70"></a>Duke University Medical Center's Cardiovascular Disease Databank provides a data set containing information about </span>
<span id="cb69-71"><a href="#cb69-71"></a>patients that has been diagnosed at Duke University Medical Center. The patients where referred to Duke for chest pain</span>
<span id="cb69-72"><a href="#cb69-72"></a>and diagnosed accordingly. If the patient was diagnosed with significant coronary disease, the blockade can be of either</span>
<span id="cb69-73"><a href="#cb69-73"></a>all three of the coronary vessels, or only of the left main coronary artery. Both conditions are associated with a high </span>
<span id="cb69-74"><a href="#cb69-74"></a>risk for mortality. </span>
<span id="cb69-75"><a href="#cb69-75"></a></span>
<span id="cb69-76"><a href="#cb69-76"></a>The scope of this report is to implement two Bayesian models able to predict the probability of significant coronary </span>
<span id="cb69-77"><a href="#cb69-77"></a>disease among patients. The two models are based on Bayesian logistic regression, but one is linear and one is non-linear.</span>
<span id="cb69-78"><a href="#cb69-78"></a>After implementation the models are evaluated and compared to achieve the best possible result.</span>
<span id="cb69-79"><a href="#cb69-79"></a></span>
<span id="cb69-80"><a href="#cb69-80"></a>In section 2 the data used in this report is described. Section 3 explains the choice of mathematical model used in this </span>
<span id="cb69-81"><a href="#cb69-81"></a>report. In section 4 the two Stan models are implemented. Section 5 evaluates and compares the implemented models. </span>
<span id="cb69-82"><a href="#cb69-82"></a>Section 6 &amp; 7 includes a final discussion and a reflection on the lessons learned during the project.</span>
<span id="cb69-83"><a href="#cb69-83"></a></span>
<span id="cb69-84"><a href="#cb69-84"></a><span class="fu"># Data Desctription</span></span>
<span id="cb69-85"><a href="#cb69-85"></a></span>
<span id="cb69-86"><a href="#cb69-86"></a>The "cath" dataset used in this report is obtained from Duke University Cardiovascular Disease Databank. It encapsulates a collection of 6 variables (@Data-table) that are closely related to cardiovascular health.</span>
<span id="cb69-87"><a href="#cb69-87"></a></span>
<span id="cb69-90"><a href="#cb69-90"></a><span class="in">```{r}</span></span>
<span id="cb69-91"><a href="#cb69-91"></a><span class="co">#| label: Data-table</span></span>
<span id="cb69-92"><a href="#cb69-92"></a><span class="co">#| echo: false</span></span>
<span id="cb69-93"><a href="#cb69-93"></a><span class="co">#| message: false</span></span>
<span id="cb69-94"><a href="#cb69-94"></a><span class="co">#| warning: false</span></span>
<span id="cb69-95"><a href="#cb69-95"></a><span class="co">#| tbl-cap: </span><span class="al">TBD</span></span>
<span id="cb69-96"><a href="#cb69-96"></a><span class="fu">kable</span>(<span class="fu">head</span>(cath))</span>
<span id="cb69-97"><a href="#cb69-97"></a><span class="in">```</span></span>
<span id="cb69-98"><a href="#cb69-98"></a></span>
<span id="cb69-99"><a href="#cb69-99"></a>The dataset consists of four explanatory variables (*sex*, *age*, *cad_dur*, *choleste*) and two response variables (*sigdz*, *tvdlm*) that provide an overview on patient demographics, clinical indicators, and critical outcomes related to coronary artery disease:</span>
<span id="cb69-100"><a href="#cb69-100"></a></span>
<span id="cb69-101"><a href="#cb69-101"></a><span class="ss">-   </span>**Sex** (*sex*): Categorized as 0 for male and 1 for female, this variable represents the gender distribution within our dataset.</span>
<span id="cb69-102"><a href="#cb69-102"></a></span>
<span id="cb69-103"><a href="#cb69-103"></a><span class="ss">-   </span>**Age** (*age*): Representing the age of patients in years, this variable serves as a demographic feature.</span>
<span id="cb69-104"><a href="#cb69-104"></a></span>
<span id="cb69-105"><a href="#cb69-105"></a><span class="ss">-   </span>**Chest Pain Duration** (*cad_dur*): The duration of chest pain symptoms in days.</span>
<span id="cb69-106"><a href="#cb69-106"></a></span>
<span id="cb69-107"><a href="#cb69-107"></a><span class="ss">-   </span>**Serum Cholesterol Level** (*choleste*): Measured in milligrams per deciliter, serum cholesterol levels are indicative of lipid metabolism and play a crucial role in cardiovascular health.</span>
<span id="cb69-108"><a href="#cb69-108"></a></span>
<span id="cb69-109"><a href="#cb69-109"></a><span class="ss">-   </span>**Significant Coronary Disease** (*sigdz*): A binary variable that captures the presence (1) or absence (0) of at least 75% blockage in one of the major coronary arteries.</span>
<span id="cb69-110"><a href="#cb69-110"></a></span>
<span id="cb69-111"><a href="#cb69-111"></a><span class="ss">-   </span>**Three Vessel Disease or Left Main Disease** (*tvdlm*): Denoting the presence (1) or absence (0) of blockage in either all three coronary vessels or in the left main coronary artery.</span>
<span id="cb69-112"><a href="#cb69-112"></a></span>
<span id="cb69-113"><a href="#cb69-113"></a>The univariate distributions of these variables are visualized in @Univariate-analysis.</span>
<span id="cb69-114"><a href="#cb69-114"></a></span>
<span id="cb69-117"><a href="#cb69-117"></a><span class="in">```{r}</span></span>
<span id="cb69-118"><a href="#cb69-118"></a><span class="co">#| label: Univariate-analysis</span></span>
<span id="cb69-119"><a href="#cb69-119"></a><span class="co">#| echo: false</span></span>
<span id="cb69-120"><a href="#cb69-120"></a><span class="co">#| fig-cap: </span><span class="al">TBD</span><span class="co"> 1</span></span>
<span id="cb69-121"><a href="#cb69-121"></a><span class="co">#| fig-show: asis</span></span>
<span id="cb69-122"><a href="#cb69-122"></a></span>
<span id="cb69-123"><a href="#cb69-123"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">1.8</span>,<span class="fl">0.8</span>,<span class="dv">0</span>), </span>
<span id="cb69-124"><a href="#cb69-124"></a>  <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.8</span>,<span class="fl">2.7</span>,<span class="fl">1.3</span>,<span class="dv">0</span>))</span>
<span id="cb69-125"><a href="#cb69-125"></a></span>
<span id="cb69-126"><a href="#cb69-126"></a>variable_names <span class="ot">=</span> <span class="fu">names</span>(cath)</span>
<span id="cb69-127"><a href="#cb69-127"></a>colors <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#F4CAE4"</span>, <span class="st">"#E6F5C9"</span>)</span>
<span id="cb69-128"><a href="#cb69-128"></a></span>
<span id="cb69-129"><a href="#cb69-129"></a><span class="co"># Explanatory variables</span></span>
<span id="cb69-130"><a href="#cb69-130"></a><span class="fu">barplot</span>(<span class="fu">table</span>(cath[,<span class="dv">1</span>]), <span class="at">main =</span> variable_names[<span class="dv">1</span>], </span>
<span id="cb69-131"><a href="#cb69-131"></a>  <span class="at">xlab =</span> variable_names[<span class="dv">1</span>], <span class="at">col =</span> colors[<span class="dv">1</span>])</span>
<span id="cb69-132"><a href="#cb69-132"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb69-133"><a href="#cb69-133"></a>  <span class="fu">hist</span>(cath[[i]], <span class="at">main =</span> variable_names[i], </span>
<span id="cb69-134"><a href="#cb69-134"></a>    <span class="at">xlab =</span> variable_names[i], <span class="at">col =</span> colors[<span class="dv">1</span>])</span>
<span id="cb69-135"><a href="#cb69-135"></a>}</span>
<span id="cb69-136"><a href="#cb69-136"></a></span>
<span id="cb69-137"><a href="#cb69-137"></a><span class="co"># Response variables</span></span>
<span id="cb69-138"><a href="#cb69-138"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>){</span>
<span id="cb69-139"><a href="#cb69-139"></a>  <span class="fu">barplot</span>(<span class="fu">table</span>(cath[,i]), <span class="at">main =</span> variable_names[i], </span>
<span id="cb69-140"><a href="#cb69-140"></a>    <span class="at">xlab =</span> variable_names[i], <span class="at">col =</span> colors[<span class="dv">2</span>])</span>
<span id="cb69-141"><a href="#cb69-141"></a>}</span>
<span id="cb69-142"><a href="#cb69-142"></a><span class="in">```</span></span>
<span id="cb69-143"><a href="#cb69-143"></a></span>
<span id="cb69-144"><a href="#cb69-144"></a>While constructing the Bayesian models to predict the probaility of significant coronary disease, the report strives to utilize the correlation between the explanatory variables (*sex*, *age*, *cad_dur*, *choleste*) and the desired response variable (*sigdz*). The *tvdlm* variable is not relevant in this report as the main focus is to predict the probability of significant coronary disease, independent of the type of the blockade.</span>
<span id="cb69-145"><a href="#cb69-145"></a></span>
<span id="cb69-148"><a href="#cb69-148"></a><span class="in">```{r}</span></span>
<span id="cb69-149"><a href="#cb69-149"></a><span class="co">#| label: Data-preprocessing</span></span>
<span id="cb69-150"><a href="#cb69-150"></a><span class="co">#| echo: false</span></span>
<span id="cb69-151"><a href="#cb69-151"></a><span class="co">#| warning: false</span></span>
<span id="cb69-152"><a href="#cb69-152"></a><span class="co">#| message: false</span></span>
<span id="cb69-153"><a href="#cb69-153"></a></span>
<span id="cb69-154"><a href="#cb69-154"></a><span class="co"># Remove tvdlm column</span></span>
<span id="cb69-155"><a href="#cb69-155"></a><span class="co"># Remove rows with at least one NA value</span></span>
<span id="cb69-156"><a href="#cb69-156"></a>cath <span class="ot">&lt;-</span> cath <span class="sc">%&gt;%</span></span>
<span id="cb69-157"><a href="#cb69-157"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-158"><a href="#cb69-158"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tvdlm)</span>
<span id="cb69-159"><a href="#cb69-159"></a></span>
<span id="cb69-160"><a href="#cb69-160"></a><span class="co"># Scale the variables</span></span>
<span id="cb69-161"><a href="#cb69-161"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(cath)<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb69-162"><a href="#cb69-162"></a>    cath[i] <span class="ot">&lt;-</span> <span class="fu">scale</span>(cath[i])</span>
<span id="cb69-163"><a href="#cb69-163"></a>}</span>
<span id="cb69-164"><a href="#cb69-164"></a></span>
<span id="cb69-165"><a href="#cb69-165"></a><span class="co"># Dimensions after preprocessing</span></span>
<span id="cb69-166"><a href="#cb69-166"></a>cath_dims <span class="ot">&lt;-</span> <span class="fu">dim</span>(cath)</span>
<span id="cb69-167"><a href="#cb69-167"></a>n_obs <span class="ot">&lt;-</span> cath_dims[<span class="dv">1</span>]</span>
<span id="cb69-168"><a href="#cb69-168"></a><span class="in">```</span></span>
<span id="cb69-169"><a href="#cb69-169"></a></span>
<span id="cb69-170"><a href="#cb69-170"></a>Before the analysis, the data is preprocessed by removing *tvdlm* column and all rows that contain missing values, as well as by scaling the continuous variables to zero mean and unit variance. After this, we are left with $n =$ `r n_obs` observations. The pairwise correlations of variables are visualized in @Bivariate-analysis. We can see that variables *sex* and *age* have the most significant bivariate correlation to the responsive variable *sigdz*.</span>
<span id="cb69-171"><a href="#cb69-171"></a></span>
<span id="cb69-174"><a href="#cb69-174"></a><span class="in">```{r}</span></span>
<span id="cb69-175"><a href="#cb69-175"></a><span class="co">#| label: Bivariate-analysis</span></span>
<span id="cb69-176"><a href="#cb69-176"></a><span class="co">#| echo: false</span></span>
<span id="cb69-177"><a href="#cb69-177"></a><span class="co">#| fig-cap: </span><span class="al">TBD</span><span class="co"> 3</span></span>
<span id="cb69-178"><a href="#cb69-178"></a><span class="co">#| fig-show: asis</span></span>
<span id="cb69-179"><a href="#cb69-179"></a><span class="co">#| fig-width: 3</span></span>
<span id="cb69-180"><a href="#cb69-180"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb69-181"><a href="#cb69-181"></a></span>
<span id="cb69-182"><a href="#cb69-182"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb69-183"><a href="#cb69-183"></a>p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(cath)</span>
<span id="cb69-184"><a href="#cb69-184"></a></span>
<span id="cb69-185"><a href="#cb69-185"></a><span class="fu">corrplot</span>(<span class="fu">cor</span>(cath[, <span class="fu">c</span>(p,<span class="dv">1</span><span class="sc">:</span>(p<span class="dv">-1</span>))]), <span class="at">type =</span> <span class="st">"full"</span>, <span class="at">method =</span> <span class="st">"number"</span>)</span>
<span id="cb69-186"><a href="#cb69-186"></a><span class="in">```</span></span>
<span id="cb69-187"><a href="#cb69-187"></a></span>
<span id="cb69-188"><a href="#cb69-188"></a><span class="fu"># Mathematical Model</span></span>
<span id="cb69-189"><a href="#cb69-189"></a></span>
<span id="cb69-190"><a href="#cb69-190"></a>In this analysis, we will construct two models for inferring the binary response variable, *sigdz* based on input explanatory variables*.* The first model is a generalized linear model (GLM), namely Bayesian logistic regression. The other model is a generalized additive mixed model (GAMM), which implements Bayesian logistic regression with nonlinear transformations on the input variables. These models will be referred as linear and nonlinear model, respectively.</span>
<span id="cb69-191"><a href="#cb69-191"></a></span>
<span id="cb69-192"><a href="#cb69-192"></a>(((To-be-done still: - Check likelihood notation for nonlinear model - Prior justification - Check prior notations - Include priors with own values ? - **Posteriors** ?)))</span>
<span id="cb69-193"><a href="#cb69-193"></a></span>
<span id="cb69-194"><a href="#cb69-194"></a><span class="fu">## The generalized linear model and priors</span></span>
<span id="cb69-195"><a href="#cb69-195"></a></span>
<span id="cb69-196"><a href="#cb69-196"></a>Let $y$ be the number of times the variable *sigdz* is realized to be 1 for one individual in the dataset, and let $x$ be the explanatory variables for this outcome. Then, this number of successes for one individual follows a Binomial distribution</span>
<span id="cb69-197"><a href="#cb69-197"></a></span>
<span id="cb69-198"><a href="#cb69-198"></a>$$</span>
<span id="cb69-199"><a href="#cb69-199"></a>y \sim \binom{n}{y}\theta^y(1-\theta)^{n-y},</span>
<span id="cb69-200"><a href="#cb69-200"></a>$$</span>
<span id="cb69-201"><a href="#cb69-201"></a></span>
<span id="cb69-202"><a href="#cb69-202"></a>where n is the number of observations for that specific individual and $\theta = g^{-1}(\eta)$ $(\eta = \alpha + x^{T} \beta)$ is the probability of success (patient presenting with significant coronary disease). The inverse link function $g^{-1}$ maps the output of the linear predictor $\eta$ to a probability interval between 0 and 1.</span>
<span id="cb69-203"><a href="#cb69-203"></a></span>
<span id="cb69-204"><a href="#cb69-204"></a>For the binomial GLM, this project utilizes logit $g(x) = \ln(\frac{x}{1-x})$ as a link function, which makes it a logistic regression model. As each individual occurs only once in the data, $y$ can be directly presented as the binary response variable. Therefore, the likelihood of the response variable of one individual is reduced to Bernoulli distribution</span>
<span id="cb69-205"><a href="#cb69-205"></a></span>
<span id="cb69-206"><a href="#cb69-206"></a>$$</span>
<span id="cb69-207"><a href="#cb69-207"></a>y \sim \text{ logit}^{-1}(\eta)^y(1-\text{ logit}^{-1}(\eta))^{1-y}.</span>
<span id="cb69-208"><a href="#cb69-208"></a>$$</span>
<span id="cb69-209"><a href="#cb69-209"></a></span>
<span id="cb69-210"><a href="#cb69-210"></a>The complete data likelihood is then a product of $n =$ <span class="in">`r n_obs`</span> likelihoods, with unshared probability of success.</span>
<span id="cb69-211"><a href="#cb69-211"></a></span>
<span id="cb69-212"><a href="#cb69-212"></a>As in Bayesian logistic regression the scope is to infer the distribution of the regression weights, namely the intercept $\alpha$ and coefficients $\beta = <span class="co">[</span><span class="ot">\beta_1, \beta_2, \beta_3, \beta_4</span><span class="co">]</span>^T$, we define the prior to be Student's $t$-distribution</span>
<span id="cb69-213"><a href="#cb69-213"></a></span>
<span id="cb69-214"><a href="#cb69-214"></a>$$</span>
<span id="cb69-215"><a href="#cb69-215"></a>\begin{aligned} </span>
<span id="cb69-216"><a href="#cb69-216"></a>\alpha &amp;\sim t_v(\mu, \sigma) <span class="sc">\\</span> </span>
<span id="cb69-217"><a href="#cb69-217"></a>\beta_k &amp;\sim t_v(\mu, \sigma), \ k=1,..,4 <span class="sc">\\</span> </span>
<span id="cb69-218"><a href="#cb69-218"></a>\end{aligned} </span>
<span id="cb69-219"><a href="#cb69-219"></a>$$</span>
<span id="cb69-220"><a href="#cb69-220"></a></span>
<span id="cb69-221"><a href="#cb69-221"></a>where $v$ is the degrees of freedom, $\mu$ is the location and $\sigma$ is the scale.</span>
<span id="cb69-222"><a href="#cb69-222"></a></span>
<span id="cb69-223"><a href="#cb69-223"></a>The selection of prior distribution was done based on the nature of the data. Due to correlations, there is reason to believe that the parameters are not very close to zero, but most are still rather small than large. Therefore, as Student's $t$-distribution has heavy tails and larger scale compared to, for example, Gaussian distribution, $t$-distribution is a suitable choice of prior for this purpose. The parameters of the prior were defined to be</span>
<span id="cb69-224"><a href="#cb69-224"></a></span>
<span id="cb69-225"><a href="#cb69-225"></a>$$</span>
<span id="cb69-226"><a href="#cb69-226"></a>v = 3, \quad \mu = 0, \quad \sigma = 2.5,</span>
<span id="cb69-227"><a href="#cb69-227"></a>$$</span>
<span id="cb69-228"><a href="#cb69-228"></a></span>
<span id="cb69-229"><a href="#cb69-229"></a>as the coefficients can be positive or negative.</span>
<span id="cb69-230"><a href="#cb69-230"></a></span>
<span id="cb69-231"><a href="#cb69-231"></a>Finally, the joint posterior distribution that is simulated using Hamiltonian Monte Carlo (HMC) is proportional to the product of likelihood and prior distributions:</span>
<span id="cb69-232"><a href="#cb69-232"></a></span>
<span id="cb69-233"><a href="#cb69-233"></a>$$</span>
<span id="cb69-234"><a href="#cb69-234"></a>p(\alpha, \beta | \textbf{x}, \textbf{y} ) \propto t_v(\alpha | \mu, \sigma) \times \prod^4_{k=1} t_v(\beta_k | \mu, \sigma) \times \prod^n_{i=1} \text{ logit}^{-1}(\eta_i)^{y_i}(1-\text{ logit}^{-1}(\eta_i))^{1-y_i}</span>
<span id="cb69-235"><a href="#cb69-235"></a>$$</span>
<span id="cb69-236"><a href="#cb69-236"></a></span>
<span id="cb69-237"><a href="#cb69-237"></a><span class="fu">## The generalized additive nonlinear model</span></span>
<span id="cb69-238"><a href="#cb69-238"></a></span>
<span id="cb69-239"><a href="#cb69-239"></a>The additive nonlinear model on the other hand, is a generalized additive mixed model which combines multiple functions in a way that is not strictly linear. This allows for a more flexible relationship between the explanatory variables and response variable $y$. In this report, the nonlinear model uses the same link function as the linear model, and so the nonlinear predictor for the logistic regression model can be written as:</span>
<span id="cb69-240"><a href="#cb69-240"></a></span>
<span id="cb69-241"><a href="#cb69-241"></a>$$</span>
<span id="cb69-242"><a href="#cb69-242"></a>\text{logit} (\theta) = \eta = \alpha + \sum^4_{k=1} \beta_k f_k(x_k),</span>
<span id="cb69-243"><a href="#cb69-243"></a>$$</span>
<span id="cb69-244"><a href="#cb69-244"></a></span>
<span id="cb69-245"><a href="#cb69-245"></a>where $f_k$ are nonlinear functions that transform the explanatory features individually. In this report, all functions of the continuous variables are smoothing functions. The $f_{age}$ is simply the variable itself, due to *sex* being binary variable. The smoothing functions utilize penalized splines, allowing the model to create a curved relationship between the features. The shape of the smoothing functions is estimated from the data and the penalty helps avoid overfitting. The smoothing function works by minimizing the sum of the model fit with the smoothness / penalty (here, thin plate regression splines (default)).</span>
<span id="cb69-246"><a href="#cb69-246"></a></span>
<span id="cb69-247"><a href="#cb69-247"></a>The likelihood of observation is the same as with the linear model, with the difference that a nonlinear transformation is applied to all input explanatory variables $\textbf{x}$. Additionally, we utilize the same prior in both models to make them as comparable as possible. The posterior is again similar as with the linear model, but with the difference of nonlinear transformations on the input data.</span>
<span id="cb69-248"><a href="#cb69-248"></a></span>
<span id="cb69-249"><a href="#cb69-249"></a><span class="fu"># Model Definitions and Implementation</span></span>
<span id="cb69-250"><a href="#cb69-250"></a></span>
<span id="cb69-251"><a href="#cb69-251"></a>The linear and nonlinear models are implemented as Stan code with the rstanarm package as described below. Both models were implemented with identical number of chains, draws and warm-up. The default values (chains = 4, draws = 4000, and warmup = 2000) were used in both cases.</span>
<span id="cb69-252"><a href="#cb69-252"></a></span>
<span id="cb69-253"><a href="#cb69-253"></a><span class="fu">## Linear model</span></span>
<span id="cb69-254"><a href="#cb69-254"></a></span>
<span id="cb69-255"><a href="#cb69-255"></a>The linear model was implemented with the help of the <span class="in">`stan_glm`</span> function from the rstanarm package. <span class="in">`stan_glm`</span> is used to fit generalized linear models and performs a full Bayesian estimation with Markov Chain Monte Carlo (MCMC) estimation instead of maximum likelihood estimation and by adding priors to the GLM coefficients and intercept. By defining the model parameter <span class="in">`family = binomial(link = 'logit')`</span> the model performs logistic regression.</span>
<span id="cb69-256"><a href="#cb69-256"></a></span>
<span id="cb69-257"><a href="#cb69-257"></a>The linear relationship between the response variable <span class="in">`sigdz`</span> and the explanatory variables are defined with the help of the <span class="in">`formula`</span> function and the prior for the regression coefficients and intercept with the help of the <span class="in">`student_t`</span> function.</span>
<span id="cb69-258"><a href="#cb69-258"></a></span>
<span id="cb69-261"><a href="#cb69-261"></a><span class="in">```{r}</span></span>
<span id="cb69-262"><a href="#cb69-262"></a><span class="co">#| label: Linear-model-definition</span></span>
<span id="cb69-263"><a href="#cb69-263"></a><span class="co">#| warning: false</span></span>
<span id="cb69-264"><a href="#cb69-264"></a><span class="co">#| message: false</span></span>
<span id="cb69-265"><a href="#cb69-265"></a></span>
<span id="cb69-266"><a href="#cb69-266"></a><span class="co"># Make response variable a factor</span></span>
<span id="cb69-267"><a href="#cb69-267"></a>cath<span class="sc">$</span>sigdz <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(cath<span class="sc">$</span>sigdz)</span>
<span id="cb69-268"><a href="#cb69-268"></a>y <span class="ot">&lt;-</span> cath<span class="sc">$</span>sigdz</span>
<span id="cb69-269"><a href="#cb69-269"></a></span>
<span id="cb69-270"><a href="#cb69-270"></a><span class="co"># Formula</span></span>
<span id="cb69-271"><a href="#cb69-271"></a>formula_linear <span class="ot">&lt;-</span> <span class="fu">formula</span>(sigdz <span class="sc">~</span> sex <span class="sc">+</span> age <span class="sc">+</span> cad_dur <span class="sc">+</span> choleste)</span>
<span id="cb69-272"><a href="#cb69-272"></a></span>
<span id="cb69-273"><a href="#cb69-273"></a><span class="co"># Prior</span></span>
<span id="cb69-274"><a href="#cb69-274"></a>prior_linear <span class="ot">&lt;-</span> <span class="fu">student_t</span>(<span class="at">df =</span> <span class="dv">3</span>, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>)</span>
<span id="cb69-275"><a href="#cb69-275"></a></span>
<span id="cb69-276"><a href="#cb69-276"></a><span class="co"># The model</span></span>
<span id="cb69-277"><a href="#cb69-277"></a>model_linear <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb69-278"><a href="#cb69-278"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), </span>
<span id="cb69-279"><a href="#cb69-279"></a>                <span class="at">prior =</span> prior_linear, <span class="at">prior_intercept =</span> prior_linear,</span>
<span id="cb69-280"><a href="#cb69-280"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb69-281"><a href="#cb69-281"></a></span>
<span id="cb69-282"><a href="#cb69-282"></a><span class="co"># saveRDS(model_linear, file = "./additional_files/model_linear.rds")</span></span>
<span id="cb69-283"><a href="#cb69-283"></a><span class="co"># model_linear &lt;- readRDS("./additional_files/model_linear.rds")                </span></span>
<span id="cb69-284"><a href="#cb69-284"></a><span class="in">```</span></span>
<span id="cb69-285"><a href="#cb69-285"></a></span>
<span id="cb69-286"><a href="#cb69-286"></a><span class="fu">## Nonlinear model</span></span>
<span id="cb69-287"><a href="#cb69-287"></a></span>
<span id="cb69-288"><a href="#cb69-288"></a>The nonlinear model is similarly implemented utilizing <span class="in">`stan_gamm4`</span> function from the rstanarm package and defined to be a logistic regression model with the help of the model parameter <span class="in">`family = binomial(link = 'logit')`</span>. <span class="in">`stan_gamm4`</span> fits a generalized additive mixed model, and performs Bayesian MCMC estimation instead of maximum likelihood estimation. In the same way as <span class="in">`stan_glm`</span>, the model adds independent priors to the regression coefficients and intercept.</span>
<span id="cb69-289"><a href="#cb69-289"></a></span>
<span id="cb69-290"><a href="#cb69-290"></a>The nonlinear relationship between the response variable <span class="in">`sigdz`</span> and the explanatory variables is again defined with the help of the <span class="in">`formula`</span> function. This time, passing the smoothing function <span class="in">`s()`</span> for all continuous explanatory variables, to allow for more complexity in the model, while simultaneously penalizing over-fitting of the model with the the thin plate regression splines smoothness.</span>
<span id="cb69-291"><a href="#cb69-291"></a></span>
<span id="cb69-292"><a href="#cb69-292"></a>The same priors are used as for the linear model for both the intercept and the regression coefficients.</span>
<span id="cb69-293"><a href="#cb69-293"></a></span>
<span id="cb69-296"><a href="#cb69-296"></a><span class="in">```{r}</span></span>
<span id="cb69-297"><a href="#cb69-297"></a><span class="co">#| label: Nonlinear model definition</span></span>
<span id="cb69-298"><a href="#cb69-298"></a><span class="co">#| warning: false</span></span>
<span id="cb69-299"><a href="#cb69-299"></a><span class="co">#| message: false</span></span>
<span id="cb69-300"><a href="#cb69-300"></a></span>
<span id="cb69-301"><a href="#cb69-301"></a><span class="co"># Formula</span></span>
<span id="cb69-302"><a href="#cb69-302"></a>formula_nonlinear <span class="ot">&lt;-</span> <span class="fu">formula</span>(sigdz <span class="sc">~</span> sex <span class="sc">+</span> <span class="fu">s</span>(age) <span class="sc">+</span> <span class="fu">s</span>(cad_dur) <span class="sc">+</span> <span class="fu">s</span>(choleste))</span>
<span id="cb69-303"><a href="#cb69-303"></a></span>
<span id="cb69-304"><a href="#cb69-304"></a><span class="co"># Model definition</span></span>
<span id="cb69-305"><a href="#cb69-305"></a>model_nonlinear <span class="ot">&lt;-</span> <span class="fu">stan_gamm4</span>(</span>
<span id="cb69-306"><a href="#cb69-306"></a>  formula_nonlinear, <span class="at">data =</span> cath,</span>
<span id="cb69-307"><a href="#cb69-307"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-308"><a href="#cb69-308"></a>  <span class="at">prior =</span> prior_linear, <span class="at">prior_intercept =</span> prior_linear,</span>
<span id="cb69-309"><a href="#cb69-309"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb69-310"><a href="#cb69-310"></a>)</span>
<span id="cb69-311"><a href="#cb69-311"></a></span>
<span id="cb69-312"><a href="#cb69-312"></a><span class="co"># saveRDS(model_nonlinear, file = "./additional_files/model_nonlinear.rds")</span></span>
<span id="cb69-313"><a href="#cb69-313"></a><span class="co"># model_nonlinear &lt;- readRDS("./additional_files/model_nonlinear.rds")</span></span>
<span id="cb69-314"><a href="#cb69-314"></a><span class="in">```</span></span>
<span id="cb69-315"><a href="#cb69-315"></a></span>
<span id="cb69-316"><a href="#cb69-316"></a><span class="fu"># Model Evaluation</span></span>
<span id="cb69-317"><a href="#cb69-317"></a></span>
<span id="cb69-318"><a href="#cb69-318"></a>After fitting the models, multiple evaluation metrics such as split-$\hat{R}$, effective sample size (ESS) and number of divergent transitions were used to assess the convergence of MCMC chains separately for each model. Additionally, we perform posterior predictive checks, assess the model performances as well as compare the models utilizing leave-one-out cross validation (LOO-CV). Finally, we perform prior sensitivity analysis for both models.</span>
<span id="cb69-319"><a href="#cb69-319"></a></span>
<span id="cb69-320"><a href="#cb69-320"></a><span class="ss">-   </span>Rhat, ESS, HMC divergences, pp_check(), loo_compare(), classification accuracy</span>
<span id="cb69-321"><a href="#cb69-321"></a><span class="ss">-   </span>Prior sensitivity analysis</span>
<span id="cb69-322"><a href="#cb69-322"></a></span>
<span id="cb69-323"><a href="#cb69-323"></a><span class="fu">## Convergence diagnostics &amp; posterior predictive checks</span></span>
<span id="cb69-324"><a href="#cb69-324"></a></span>
<span id="cb69-325"><a href="#cb69-325"></a>For the linear model, the posterior predictive check and posterior distributions of the parameters with 95 % credible interval are visualized in @linear-model-pp-check. As we can see, the model fits the data relatively well, with a bit of a variation around the probability interval endpoints.</span>
<span id="cb69-326"><a href="#cb69-326"></a></span>
<span id="cb69-329"><a href="#cb69-329"></a><span class="in">```{r}</span></span>
<span id="cb69-330"><a href="#cb69-330"></a><span class="co">#| label: linear-model-pp-check</span></span>
<span id="cb69-331"><a href="#cb69-331"></a><span class="co">#| fig-cap: </span><span class="al">TBD</span></span>
<span id="cb69-332"><a href="#cb69-332"></a><span class="co">#| fig-show: asis</span></span>
<span id="cb69-333"><a href="#cb69-333"></a><span class="co">#| echo: false</span></span>
<span id="cb69-334"><a href="#cb69-334"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb69-335"><a href="#cb69-335"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb69-336"><a href="#cb69-336"></a></span>
<span id="cb69-337"><a href="#cb69-337"></a><span class="co"># posteriors</span></span>
<span id="cb69-338"><a href="#cb69-338"></a>pplot_linear <span class="ot">&lt;-</span> <span class="fu">plot</span>(model_linear, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb69-339"><a href="#cb69-339"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb69-340"><a href="#cb69-340"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Posterior distributions of the linear model"</span>)</span>
<span id="cb69-341"><a href="#cb69-341"></a><span class="co"># pp check</span></span>
<span id="cb69-342"><a href="#cb69-342"></a>pp_check_linear <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">pp_check</span>(model_linear) <span class="sc">+</span></span>
<span id="cb69-343"><a href="#cb69-343"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Posterior predictive check for the linear model"</span>)</span>
<span id="cb69-344"><a href="#cb69-344"></a><span class="fu">grid.arrange</span>(pplot_linear, pp_check_linear, <span class="at">ncol=</span><span class="dv">2</span>) </span>
<span id="cb69-345"><a href="#cb69-345"></a><span class="in">```</span></span>
<span id="cb69-346"><a href="#cb69-346"></a></span>
<span id="cb69-347"><a href="#cb69-347"></a>The convergence diagnostics for the linear model are summarized below.</span>
<span id="cb69-348"><a href="#cb69-348"></a></span>
<span id="cb69-351"><a href="#cb69-351"></a><span class="in">```{r}</span></span>
<span id="cb69-352"><a href="#cb69-352"></a><span class="co">#| label: Linear-model-convergence-diagnostics</span></span>
<span id="cb69-353"><a href="#cb69-353"></a><span class="co">#| echo: false</span></span>
<span id="cb69-354"><a href="#cb69-354"></a></span>
<span id="cb69-355"><a href="#cb69-355"></a>Rhat_linear <span class="ot">&lt;-</span> model_linear<span class="sc">$</span>stan_summary[, <span class="st">"Rhat"</span>] <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb69-356"><a href="#cb69-356"></a>np_linear <span class="ot">&lt;-</span> <span class="fu">nuts_params</span>(model_linear)</span>
<span id="cb69-357"><a href="#cb69-357"></a>divergents_linear <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">subset</span>(np_linear, Parameter <span class="sc">==</span> <span class="st">"divergent__"</span>)<span class="sc">$</span>Value)</span>
<span id="cb69-358"><a href="#cb69-358"></a>ess_ratio_linear <span class="ot">&lt;-</span> <span class="fu">neff_ratio</span>(model_linear)</span>
<span id="cb69-359"><a href="#cb69-359"></a>sd_ess_ratio_linear <span class="ot">&lt;-</span> <span class="fu">sd</span>(ess_ratio_linear) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb69-360"><a href="#cb69-360"></a></span>
<span id="cb69-361"><a href="#cb69-361"></a><span class="fu">cat</span>(<span class="st">"Split-Rhat:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb69-362"><a href="#cb69-362"></a><span class="fu">print</span>(Rhat_linear)</span>
<span id="cb69-363"><a href="#cb69-363"></a><span class="fu">cat</span>(<span class="st">"Number of divergent transitions: "</span>, divergents_linear, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb69-364"><a href="#cb69-364"></a><span class="fu">cat</span>(<span class="st">"ESS ratio: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb69-365"><a href="#cb69-365"></a><span class="fu">print</span>(ess_ratio_linear)</span>
<span id="cb69-366"><a href="#cb69-366"></a><span class="fu">cat</span>(<span class="st">"Sd of ESS ratio: "</span>, sd_ess_ratio_linear)</span>
<span id="cb69-367"><a href="#cb69-367"></a><span class="in">```</span></span>
<span id="cb69-368"><a href="#cb69-368"></a></span>
<span id="cb69-369"><a href="#cb69-369"></a>The HMC chains have converged, as all split-$\hat{R}$ values are below 0.01. Additionally, there were no divergent transitions during convergence, and thus the HMC simulation is reliable. The ratio of the ESS to the true sample size is over 1 with all explanatory variables as well as the intercept. Although high ESS is generally a good thing, this also implies the MCMC samples may have a negative correlation.</span>
<span id="cb69-370"><a href="#cb69-370"></a></span>
<span id="cb69-371"><a href="#cb69-371"></a>For the nonlinear model, the posterior predictive check is visualized in @nonlinear-model-pp-check. Based on visual inspection, the nonlinear model fits the data as well as the linear model. Like with the linear model, the posterior has a bit of a variation around the probability interval endpoints.</span>
<span id="cb69-372"><a href="#cb69-372"></a></span>
<span id="cb69-375"><a href="#cb69-375"></a><span class="in">```{r}</span></span>
<span id="cb69-376"><a href="#cb69-376"></a><span class="co">#| label: nonlinear-model-pp-check</span></span>
<span id="cb69-377"><a href="#cb69-377"></a><span class="co">#| fig-cap: </span><span class="al">TBD</span></span>
<span id="cb69-378"><a href="#cb69-378"></a><span class="co">#| fig-show: asis</span></span>
<span id="cb69-379"><a href="#cb69-379"></a><span class="co">#| echo: false</span></span>
<span id="cb69-380"><a href="#cb69-380"></a></span>
<span id="cb69-381"><a href="#cb69-381"></a><span class="co"># pp check</span></span>
<span id="cb69-382"><a href="#cb69-382"></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(model_nonlinear) <span class="sc">+</span></span>
<span id="cb69-383"><a href="#cb69-383"></a><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Posterior predictive check for the nonlinear model"</span>)</span>
<span id="cb69-384"><a href="#cb69-384"></a><span class="in">```</span></span>
<span id="cb69-385"><a href="#cb69-385"></a></span>
<span id="cb69-386"><a href="#cb69-386"></a>The convergence diagnostics for the nonlinear model are summarized below.</span>
<span id="cb69-387"><a href="#cb69-387"></a></span>
<span id="cb69-390"><a href="#cb69-390"></a><span class="in">```{r}</span></span>
<span id="cb69-391"><a href="#cb69-391"></a><span class="co">#| label: Nonlinear-model-Convergence-diagnostics</span></span>
<span id="cb69-392"><a href="#cb69-392"></a><span class="co">#| echo: false</span></span>
<span id="cb69-393"><a href="#cb69-393"></a></span>
<span id="cb69-394"><a href="#cb69-394"></a>Rhat_nonlinear <span class="ot">&lt;-</span> model_nonlinear<span class="sc">$</span>stan_summary[, <span class="st">"Rhat"</span>] <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb69-395"><a href="#cb69-395"></a>np_nonlinear <span class="ot">&lt;-</span> <span class="fu">nuts_params</span>(model_nonlinear)</span>
<span id="cb69-396"><a href="#cb69-396"></a>divergents_nonlinear <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">subset</span>(np_nonlinear, Parameter <span class="sc">==</span> <span class="st">"divergent__"</span>)<span class="sc">$</span>Value)</span>
<span id="cb69-397"><a href="#cb69-397"></a>ess_ratio_nonlinear <span class="ot">&lt;-</span> <span class="fu">neff_ratio</span>(model_nonlinear) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb69-398"><a href="#cb69-398"></a></span>
<span id="cb69-399"><a href="#cb69-399"></a>rhat_satisfied_nonlinear <span class="ot">&lt;-</span> <span class="fu">all</span>(Rhat_nonlinear <span class="sc">&lt;=</span> <span class="fl">1.01</span>)</span>
<span id="cb69-400"><a href="#cb69-400"></a>mean_ess_ratio <span class="ot">&lt;-</span> <span class="fu">mean</span>(ess_ratio_nonlinear) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb69-401"><a href="#cb69-401"></a>sd_ess_ratio_nonlinear <span class="ot">&lt;-</span> <span class="fu">sd</span>(ess_ratio_nonlinear) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb69-402"><a href="#cb69-402"></a></span>
<span id="cb69-403"><a href="#cb69-403"></a><span class="fu">cat</span>(<span class="st">"Split-Rhat of the first coefficients:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb69-404"><a href="#cb69-404"></a><span class="fu">print</span>(<span class="fu">head</span>(Rhat_nonlinear))</span>
<span id="cb69-405"><a href="#cb69-405"></a><span class="fu">cat</span>(<span class="st">"All split-Rhat &lt;= 0.01: "</span>, rhat_satisfied_nonlinear, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb69-406"><a href="#cb69-406"></a><span class="fu">cat</span>(<span class="st">"Number of divergent transitions: "</span>,divergents_nonlinear, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb69-407"><a href="#cb69-407"></a><span class="fu">cat</span>(<span class="st">"ESS ratio of the first coefficients: </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb69-408"><a href="#cb69-408"></a><span class="fu">print</span>(<span class="fu">head</span>(ess_ratio_nonlinear))</span>
<span id="cb69-409"><a href="#cb69-409"></a><span class="fu">cat</span>(<span class="st">"Mean of ESS ratio: "</span>, mean_ess_ratio)</span>
<span id="cb69-410"><a href="#cb69-410"></a><span class="fu">cat</span>(<span class="st">"Sd of ESS ratio: "</span>, sd_ess_ratio_nonlinear)</span>
<span id="cb69-411"><a href="#cb69-411"></a><span class="in">```</span></span>
<span id="cb69-412"><a href="#cb69-412"></a></span>
<span id="cb69-413"><a href="#cb69-413"></a>Also the MCMC chains for this model have converged, as the split-$\hat{R}$ is less than 0.01 for all coefficients. As with the linear model, there were no divergent transitions during convergence, and thus the HMC simulation is reliable. On the other hand, the ESS ratio is on average less than 1, so a bit lower than with the linear model. However, the standard deviation of the ESS ratios is over twice larger than with the linear model. Low ESS ratio is not good in the model sense, but nevertheless the nonlinear has multiple coefficients to balance out the overall effect.</span>
<span id="cb69-414"><a href="#cb69-414"></a></span>
<span id="cb69-415"><a href="#cb69-415"></a><span class="fu">## Model comparison using LOO-CV</span></span>
<span id="cb69-416"><a href="#cb69-416"></a></span>
<span id="cb69-417"><a href="#cb69-417"></a>To compare the performance of the linear model and nonlinear model to each other as well as to a baseline model, we will compute the expected log-densities of the predictive distributions (ELPD) by applying Pareto smoothed LOO-CV (PSIS-LOO) to the models. The baseline model is simply a logistic regression model without any explanatory variables and with a unit coefficient.</span>
<span id="cb69-418"><a href="#cb69-418"></a></span>
<span id="cb69-421"><a href="#cb69-421"></a><span class="in">```{r}</span></span>
<span id="cb69-422"><a href="#cb69-422"></a><span class="co">#| label: Baseline-model</span></span>
<span id="cb69-423"><a href="#cb69-423"></a><span class="co"># Baseline model</span></span>
<span id="cb69-424"><a href="#cb69-424"></a>model_baseline <span class="ot">&lt;-</span> <span class="fu">update</span>(model_linear, <span class="at">formula =</span> sigdz <span class="sc">~</span> <span class="dv">1</span>, <span class="at">QR =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-425"><a href="#cb69-425"></a><span class="in">```</span></span>
<span id="cb69-426"><a href="#cb69-426"></a></span>
<span id="cb69-427"><a href="#cb69-427"></a>The results of the PSIS-LOO for each model are presented below.</span>
<span id="cb69-428"><a href="#cb69-428"></a></span>
<span id="cb69-431"><a href="#cb69-431"></a><span class="in">```{r}</span></span>
<span id="cb69-432"><a href="#cb69-432"></a><span class="co">#| label: Computing-LOOs</span></span>
<span id="cb69-433"><a href="#cb69-433"></a><span class="co">#| echo: false</span></span>
<span id="cb69-434"><a href="#cb69-434"></a><span class="co">#| warnings: false</span></span>
<span id="cb69-435"><a href="#cb69-435"></a><span class="co"># LOO of our models</span></span>
<span id="cb69-436"><a href="#cb69-436"></a>loo_linear <span class="ot">&lt;-</span> <span class="fu">loo</span>(model_linear, <span class="at">save_psis =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-437"><a href="#cb69-437"></a>loo_nonlinear <span class="ot">&lt;-</span> <span class="fu">loo</span>(model_nonlinear, <span class="at">save_psis =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-438"><a href="#cb69-438"></a><span class="co"># LOO of the baseline model</span></span>
<span id="cb69-439"><a href="#cb69-439"></a>loo_baseline <span class="ot">&lt;-</span> <span class="fu">loo</span>(model_baseline, <span class="at">save_psis =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-440"><a href="#cb69-440"></a><span class="in">```</span></span>
<span id="cb69-441"><a href="#cb69-441"></a></span>
<span id="cb69-444"><a href="#cb69-444"></a><span class="in">```{r}</span></span>
<span id="cb69-445"><a href="#cb69-445"></a><span class="co">#| label: Printing-LOOs</span></span>
<span id="cb69-446"><a href="#cb69-446"></a><span class="co">#| echo: false</span></span>
<span id="cb69-447"><a href="#cb69-447"></a><span class="fu">cat</span>(<span class="st">"Linear model:"</span>)</span>
<span id="cb69-448"><a href="#cb69-448"></a><span class="fu">print</span>(loo_linear)</span>
<span id="cb69-449"><a href="#cb69-449"></a><span class="fu">cat</span>(<span class="st">"Nonlinear model:"</span>)</span>
<span id="cb69-450"><a href="#cb69-450"></a><span class="fu">print</span>(loo_nonlinear)</span>
<span id="cb69-451"><a href="#cb69-451"></a><span class="fu">cat</span>(<span class="st">"Baseline model:"</span>)</span>
<span id="cb69-452"><a href="#cb69-452"></a><span class="fu">print</span>(loo_baseline)</span>
<span id="cb69-453"><a href="#cb69-453"></a><span class="in">```</span></span>
<span id="cb69-454"><a href="#cb69-454"></a></span>
<span id="cb69-455"><a href="#cb69-455"></a>For each model, all Pareto k estimates are <span class="sc">\&lt;</span> 0.5, which implies the importance sampling gives a reliable estimate on the computed ELPDs. Additionally, for linear and nonlinear model the p_loo is less than the number of parameters in the respective model, and thus the model specifications seem to be reasonable.</span>
<span id="cb69-456"><a href="#cb69-456"></a></span>
<span id="cb69-457"><a href="#cb69-457"></a>To assess the model ELPDs with respect to each other, we compute the comparison between the results of PSIS-LOO:</span>
<span id="cb69-458"><a href="#cb69-458"></a></span>
<span id="cb69-461"><a href="#cb69-461"></a><span class="in">```{r}</span></span>
<span id="cb69-462"><a href="#cb69-462"></a><span class="co">#| label: Comparing LOOs</span></span>
<span id="cb69-463"><a href="#cb69-463"></a><span class="co">#| echo: false</span></span>
<span id="cb69-464"><a href="#cb69-464"></a><span class="fu">loo_compare</span>(loo_linear, loo_nonlinear, loo_baseline)</span>
<span id="cb69-465"><a href="#cb69-465"></a><span class="in">```</span></span>
<span id="cb69-466"><a href="#cb69-466"></a></span>
<span id="cb69-467"><a href="#cb69-467"></a>It indeed seems that the predictive performances of both linear and nonlinear models are better compared to the baseline model. Additionally, the scale of the difference of standard errors (se_diff) of the baseline model and nonlinear model is smaller than the difference of the ELPDs of the nonlinear and baseline model, which implies the difference in predictive log-densities between these models is not simply explained by the variance. Although the difference in ELPDs of the linear and nonlinear models is small, the nonlinear model slightly outperforms the linear model.</span>
<span id="cb69-468"><a href="#cb69-468"></a></span>
<span id="cb69-469"><a href="#cb69-469"></a><span class="fu">## Posterior predictive performance: Classification accuracy</span></span>
<span id="cb69-470"><a href="#cb69-470"></a></span>
<span id="cb69-471"><a href="#cb69-471"></a>To estimate the generalization error, i.e. the generalization and performance of models on unseen data, we compute LOO-balanced classification accuracies for the linear and nonlinear models. The results are summarized in @Classification-accuracies. The classification accuracy is simply the fraction of correctly classified observations. The balanced classification accuracy on the other hand takes into account true positive rate (sensitivity) and true negative rate (specificity). The latter accounts for the imbalance in our data and is therefore more accurate estimate on the generalization error. Estimating generalization error is highly important for practical usage of the model, as it would be centered around predicting</span>
<span id="cb69-472"><a href="#cb69-472"></a></span>
<span id="cb69-475"><a href="#cb69-475"></a><span class="in">```{r}</span></span>
<span id="cb69-476"><a href="#cb69-476"></a><span class="co">#| label: Linear-model-Classification-accuracy</span></span>
<span id="cb69-477"><a href="#cb69-477"></a><span class="co">#| echo: false</span></span>
<span id="cb69-478"><a href="#cb69-478"></a></span>
<span id="cb69-479"><a href="#cb69-479"></a><span class="do">## Predicted probabilities</span></span>
<span id="cb69-480"><a href="#cb69-480"></a>preds_linear <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(model_linear)</span>
<span id="cb69-481"><a href="#cb69-481"></a></span>
<span id="cb69-482"><a href="#cb69-482"></a><span class="co"># LOO predicted outcome probabilities</span></span>
<span id="cb69-483"><a href="#cb69-483"></a>ploo_linear <span class="ot">=</span> <span class="fu">E_loo</span>(preds_linear, loo_linear<span class="sc">$</span>psis_object, </span>
<span id="cb69-484"><a href="#cb69-484"></a>  <span class="at">type=</span><span class="st">"mean"</span>, <span class="at">log_ratios =</span> <span class="sc">-</span><span class="fu">log_lik</span>(model_linear))<span class="sc">$</span>value</span>
<span id="cb69-485"><a href="#cb69-485"></a></span>
<span id="cb69-486"><a href="#cb69-486"></a><span class="co"># Classification accuracy</span></span>
<span id="cb69-487"><a href="#cb69-487"></a>accuracy_linear <span class="ot">&lt;-</span> <span class="fu">xor</span>(ploo_linear<span class="sc">&gt;</span><span class="fl">0.5</span>, <span class="fu">as.integer</span>(y<span class="sc">==</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="fu">mean</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb69-488"><a href="#cb69-488"></a></span>
<span id="cb69-489"><a href="#cb69-489"></a><span class="co"># Posterior balanced LOO classification accuracy</span></span>
<span id="cb69-490"><a href="#cb69-490"></a>FP_linear <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">xor</span>(ploo_linear[y<span class="sc">==</span><span class="dv">0</span>]<span class="sc">&gt;</span><span class="fl">0.5</span>,<span class="fu">as.integer</span>(y[y<span class="sc">==</span><span class="dv">0</span>])))</span>
<span id="cb69-491"><a href="#cb69-491"></a>FN_linear <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">xor</span>(ploo_linear[y<span class="sc">==</span><span class="dv">1</span>]<span class="sc">&lt;</span><span class="fl">0.5</span>,<span class="fu">as.integer</span>(y[y<span class="sc">==</span><span class="dv">1</span>])))</span>
<span id="cb69-492"><a href="#cb69-492"></a>balanced_accuracy_linear <span class="ot">&lt;-</span> <span class="fu">round</span>((FP_linear <span class="sc">+</span> FN_linear)<span class="sc">/</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb69-493"><a href="#cb69-493"></a><span class="in">```</span></span>
<span id="cb69-494"><a href="#cb69-494"></a></span>
<span id="cb69-497"><a href="#cb69-497"></a><span class="in">```{r}</span></span>
<span id="cb69-498"><a href="#cb69-498"></a><span class="co">#| label: Noninear-model-Classification-accuracy</span></span>
<span id="cb69-499"><a href="#cb69-499"></a><span class="co">#| echo: false</span></span>
<span id="cb69-500"><a href="#cb69-500"></a></span>
<span id="cb69-501"><a href="#cb69-501"></a><span class="do">## Predicted probabilities</span></span>
<span id="cb69-502"><a href="#cb69-502"></a>preds_nonlinear <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(model_nonlinear)</span>
<span id="cb69-503"><a href="#cb69-503"></a></span>
<span id="cb69-504"><a href="#cb69-504"></a><span class="co"># LOO predicted outcome probabilities</span></span>
<span id="cb69-505"><a href="#cb69-505"></a>ploo_nonlinear<span class="ot">=</span><span class="fu">E_loo</span>(preds_nonlinear, loo_nonlinear<span class="sc">$</span>psis_object, </span>
<span id="cb69-506"><a href="#cb69-506"></a>  <span class="at">type=</span><span class="st">"mean"</span>, <span class="at">log_ratios =</span> <span class="sc">-</span><span class="fu">log_lik</span>(model_nonlinear))<span class="sc">$</span>value</span>
<span id="cb69-507"><a href="#cb69-507"></a></span>
<span id="cb69-508"><a href="#cb69-508"></a><span class="co"># Classification accuracy</span></span>
<span id="cb69-509"><a href="#cb69-509"></a>accuracy_nonlinear <span class="ot">&lt;-</span> <span class="fu">xor</span>(ploo_nonlinear<span class="sc">&gt;</span><span class="fl">0.5</span>,<span class="fu">as.integer</span>(y<span class="sc">==</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="fu">mean</span>() <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb69-510"><a href="#cb69-510"></a></span>
<span id="cb69-511"><a href="#cb69-511"></a><span class="co"># Posterior balanced LOO classification accuracy</span></span>
<span id="cb69-512"><a href="#cb69-512"></a>FP_nonlinear <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">xor</span>(ploo_nonlinear[y<span class="sc">==</span><span class="dv">0</span>]<span class="sc">&gt;</span><span class="fl">0.5</span>,<span class="fu">as.integer</span>(y[y<span class="sc">==</span><span class="dv">0</span>])))</span>
<span id="cb69-513"><a href="#cb69-513"></a>FN_nonlinear <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">xor</span>(ploo_nonlinear[y<span class="sc">==</span><span class="dv">1</span>]<span class="sc">&lt;</span><span class="fl">0.5</span>,<span class="fu">as.integer</span>(y[y<span class="sc">==</span><span class="dv">1</span>])))</span>
<span id="cb69-514"><a href="#cb69-514"></a>balanced_accuracy_nonlinear <span class="ot">&lt;-</span> <span class="fu">round</span>((FP_nonlinear <span class="sc">+</span> FN_nonlinear)<span class="sc">/</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb69-515"><a href="#cb69-515"></a><span class="in">```</span></span>
<span id="cb69-516"><a href="#cb69-516"></a></span>
<span id="cb69-519"><a href="#cb69-519"></a><span class="in">```{r}</span></span>
<span id="cb69-520"><a href="#cb69-520"></a><span class="co">#| label: Classification-accuracies</span></span>
<span id="cb69-521"><a href="#cb69-521"></a><span class="co">#| echo: false</span></span>
<span id="cb69-522"><a href="#cb69-522"></a><span class="co">#| tbl-cap: </span><span class="al">TBD</span></span>
<span id="cb69-523"><a href="#cb69-523"></a></span>
<span id="cb69-524"><a href="#cb69-524"></a>accuracies <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb69-525"><a href="#cb69-525"></a>  <span class="at">classification_accuracy =</span> <span class="fu">c</span>(accuracy_linear, accuracy_nonlinear),</span>
<span id="cb69-526"><a href="#cb69-526"></a>  <span class="at">balanced_classification_accuracy =</span> <span class="fu">c</span>(balanced_accuracy_linear, balanced_accuracy_nonlinear)</span>
<span id="cb69-527"><a href="#cb69-527"></a>)</span>
<span id="cb69-528"><a href="#cb69-528"></a><span class="fu">rownames</span>(accuracies) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"linear_model"</span>, <span class="st">"nonlinear_model"</span>)</span>
<span id="cb69-529"><a href="#cb69-529"></a><span class="fu">kable</span>(accuracies)</span>
<span id="cb69-530"><a href="#cb69-530"></a><span class="in">```</span></span>
<span id="cb69-531"><a href="#cb69-531"></a></span>
<span id="cb69-532"><a href="#cb69-532"></a>We can see that the performances of both models are nearly equal. The classification accuracy is slightly better for the nonlinear model, but the balanced accuracy is the same for both models. The the balanced classification accuracy is not very high, but nevertheless, both models outperform a random classifier.</span>
<span id="cb69-533"><a href="#cb69-533"></a></span>
<span id="cb69-534"><a href="#cb69-534"></a>To further compare the predictive performances of the models, calibration plots of both linear and nonlinear models are visualized in @Calibration-plots. From these plots we can see that both models are calibrated on approximately the interval of <span class="co">[</span><span class="ot">0.25, 0.5</span><span class="co">]</span> of predicted probabilities. For the top 10% there are more predictions than observations, and for the bottom 20% there are more observations than predictions.</span>
<span id="cb69-535"><a href="#cb69-535"></a></span>
<span id="cb69-538"><a href="#cb69-538"></a><span class="in">```{r}</span></span>
<span id="cb69-539"><a href="#cb69-539"></a><span class="co">#| label: Calibration-plots</span></span>
<span id="cb69-540"><a href="#cb69-540"></a><span class="co">#| fig-cap: </span><span class="al">TBD</span><span class="co"> X</span></span>
<span id="cb69-541"><a href="#cb69-541"></a><span class="co">#| fig-show: asis</span></span>
<span id="cb69-542"><a href="#cb69-542"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb69-543"><a href="#cb69-543"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb69-544"><a href="#cb69-544"></a><span class="co">#| echo: false</span></span>
<span id="cb69-545"><a href="#cb69-545"></a></span>
<span id="cb69-546"><a href="#cb69-546"></a>cplot_linear <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">loopred=</span>ploo_linear,</span>
<span id="cb69-547"><a href="#cb69-547"></a>  <span class="at">y=</span><span class="fu">as.numeric</span>(y)<span class="sc">-</span><span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">x=</span>loopred, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb69-548"><a href="#cb69-548"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">'glm'</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="dv">5</span>), <span class="at">fullrange=</span><span class="cn">TRUE</span>, <span class="at">color=</span><span class="st">"deeppink"</span>) <span class="sc">+</span></span>
<span id="cb69-549"><a href="#cb69-549"></a>  <span class="fu">geom_abline</span>(<span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="cb69-550"><a href="#cb69-550"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted (LOO)"</span>,<span class="at">y =</span> <span class="st">"Observed"</span>,<span class="at">title =</span> <span class="st">"Linear model - Calibration plot"</span>) <span class="sc">+</span></span>
<span id="cb69-551"><a href="#cb69-551"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span><span class="fl">0.02</span>, <span class="at">width=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb69-552"><a href="#cb69-552"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb69-553"><a href="#cb69-553"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb69-554"><a href="#cb69-554"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb69-555"><a href="#cb69-555"></a></span>
<span id="cb69-556"><a href="#cb69-556"></a>cplot_nonlinear <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">loopred=</span>ploo_nonlinear,</span>
<span id="cb69-557"><a href="#cb69-557"></a>  <span class="at">y=</span><span class="fu">as.numeric</span>(y)<span class="sc">-</span><span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">x=</span>loopred, <span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb69-558"><a href="#cb69-558"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">'glm'</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">ns</span>(x, <span class="dv">5</span>), <span class="at">fullrange=</span><span class="cn">TRUE</span>, <span class="at">color=</span><span class="st">"deeppink"</span>) <span class="sc">+</span></span>
<span id="cb69-559"><a href="#cb69-559"></a>  <span class="fu">geom_abline</span>(<span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span> </span>
<span id="cb69-560"><a href="#cb69-560"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted (LOO)"</span>,<span class="at">y =</span> <span class="st">"Observed"</span>,<span class="at">title =</span> <span class="st">"Nonlinear model - Calibration plot"</span>) <span class="sc">+</span></span>
<span id="cb69-561"><a href="#cb69-561"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span><span class="fl">0.02</span>, <span class="at">width=</span><span class="dv">0</span>, <span class="at">alpha=</span><span class="fl">0.05</span>) <span class="sc">+</span> </span>
<span id="cb69-562"><a href="#cb69-562"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>)) <span class="sc">+</span> </span>
<span id="cb69-563"><a href="#cb69-563"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb69-564"><a href="#cb69-564"></a>  <span class="fu">theme_minimal</span>() </span>
<span id="cb69-565"><a href="#cb69-565"></a></span>
<span id="cb69-566"><a href="#cb69-566"></a><span class="fu">grid.arrange</span>(cplot_linear, cplot_nonlinear, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb69-567"><a href="#cb69-567"></a><span class="in">```</span></span>
<span id="cb69-568"><a href="#cb69-568"></a></span>
<span id="cb69-569"><a href="#cb69-569"></a><span class="fu">## Prior sensitivity analysis</span></span>
<span id="cb69-570"><a href="#cb69-570"></a></span>
<span id="cb69-573"><a href="#cb69-573"></a><span class="in">```{r}</span></span>
<span id="cb69-574"><a href="#cb69-574"></a><span class="co">#| label: Linear model - Prior sensititivy analysis</span></span>
<span id="cb69-575"><a href="#cb69-575"></a><span class="co">#normal prior</span></span>
<span id="cb69-576"><a href="#cb69-576"></a>normal_prior <span class="ot">&lt;-</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="cn">NULL</span>, <span class="at">autoscale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-577"><a href="#cb69-577"></a>linear_model_normal_prior <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb69-578"><a href="#cb69-578"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-579"><a href="#cb69-579"></a>                <span class="at">prior =</span> normal_prior, <span class="at">prior_intercept =</span> normal_prior,</span>
<span id="cb69-580"><a href="#cb69-580"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb69-581"><a href="#cb69-581"></a></span>
<span id="cb69-582"><a href="#cb69-582"></a><span class="co">#default prior</span></span>
<span id="cb69-583"><a href="#cb69-583"></a>linear_model_default_prior <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb69-584"><a href="#cb69-584"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-585"><a href="#cb69-585"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb69-586"><a href="#cb69-586"></a></span>
<span id="cb69-587"><a href="#cb69-587"></a><span class="co">#cauchy prior</span></span>
<span id="cb69-588"><a href="#cb69-588"></a>cauchy_prior <span class="ot">&lt;-</span> <span class="fu">cauchy</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="cn">NULL</span>, <span class="at">autoscale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-589"><a href="#cb69-589"></a>linear_model_cauchy_prior <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb69-590"><a href="#cb69-590"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-591"><a href="#cb69-591"></a>                <span class="at">prior =</span> cauchy_prior, <span class="at">prior_intercept =</span> cauchy_prior,</span>
<span id="cb69-592"><a href="#cb69-592"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb69-593"><a href="#cb69-593"></a></span>
<span id="cb69-594"><a href="#cb69-594"></a><span class="co">#normal prior, large scale N(0, 100)</span></span>
<span id="cb69-595"><a href="#cb69-595"></a>normal_prior_sd <span class="ot">&lt;-</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">100</span>, <span class="at">autoscale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-596"><a href="#cb69-596"></a>linear_model_normal_sd <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb69-597"><a href="#cb69-597"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-598"><a href="#cb69-598"></a>                <span class="at">prior =</span> normal_prior_sd, <span class="at">prior_intercept =</span> normal_prior_sd,</span>
<span id="cb69-599"><a href="#cb69-599"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb69-600"><a href="#cb69-600"></a></span>
<span id="cb69-601"><a href="#cb69-601"></a><span class="co">#normal prior, large location</span></span>
<span id="cb69-602"><a href="#cb69-602"></a>normal_prior_loc <span class="ot">&lt;-</span> <span class="fu">normal</span>(<span class="dv">100</span>, <span class="at">scale =</span> <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-603"><a href="#cb69-603"></a>linear_model_normal_loc <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb69-604"><a href="#cb69-604"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-605"><a href="#cb69-605"></a>                <span class="at">prior =</span> normal_prior_loc, <span class="at">prior_intercept =</span> normal_prior_loc,</span>
<span id="cb69-606"><a href="#cb69-606"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb69-607"><a href="#cb69-607"></a></span>
<span id="cb69-608"><a href="#cb69-608"></a><span class="co">#flat prior</span></span>
<span id="cb69-609"><a href="#cb69-609"></a>flat_prior <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb69-610"><a href="#cb69-610"></a>linear_model_flat_prior <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(formula_linear, <span class="at">data =</span> cath,</span>
<span id="cb69-611"><a href="#cb69-611"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-612"><a href="#cb69-612"></a>                <span class="at">prior =</span> flat_prior, <span class="at">prior_intercept =</span> flat_prior,</span>
<span id="cb69-613"><a href="#cb69-613"></a>                <span class="at">QR=</span><span class="cn">TRUE</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb69-614"><a href="#cb69-614"></a></span>
<span id="cb69-615"><a href="#cb69-615"></a></span>
<span id="cb69-616"><a href="#cb69-616"></a></span>
<span id="cb69-617"><a href="#cb69-617"></a></span>
<span id="cb69-618"><a href="#cb69-618"></a><span class="in">```</span></span>
<span id="cb69-619"><a href="#cb69-619"></a></span>
<span id="cb69-620"><a href="#cb69-620"></a>Plotting the posterior distribution for each prior:</span>
<span id="cb69-621"><a href="#cb69-621"></a></span>
<span id="cb69-624"><a href="#cb69-624"></a><span class="in">```{r}</span></span>
<span id="cb69-625"><a href="#cb69-625"></a><span class="co">#| label: Linear model - Plotting prior sensititvy </span></span>
<span id="cb69-626"><a href="#cb69-626"></a>pplot_normal <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_normal_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-627"><a href="#cb69-627"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Normal prior"</span>)</span>
<span id="cb69-628"><a href="#cb69-628"></a></span>
<span id="cb69-629"><a href="#cb69-629"></a>pplot_default <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_default_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-630"><a href="#cb69-630"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Default prior"</span>)</span>
<span id="cb69-631"><a href="#cb69-631"></a></span>
<span id="cb69-632"><a href="#cb69-632"></a>pplot_cauchy <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_cauchy_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-633"><a href="#cb69-633"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cauchy prior"</span>)</span>
<span id="cb69-634"><a href="#cb69-634"></a></span>
<span id="cb69-635"><a href="#cb69-635"></a><span class="co"># pplot_linear &lt;- pplot_linear + geom_vline(xintercept = 0) + labs(title = "Model prior")</span></span>
<span id="cb69-636"><a href="#cb69-636"></a></span>
<span id="cb69-637"><a href="#cb69-637"></a>pplot_normal_sd <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_normal_sd, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb69-638"><a href="#cb69-638"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"N(0, 100)"</span>)</span>
<span id="cb69-639"><a href="#cb69-639"></a></span>
<span id="cb69-640"><a href="#cb69-640"></a>pplot_normal_loc <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_normal_loc, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb69-641"><a href="#cb69-641"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"N(100, 0)"</span>)</span>
<span id="cb69-642"><a href="#cb69-642"></a></span>
<span id="cb69-643"><a href="#cb69-643"></a>pplot_flat <span class="ot">&lt;-</span> <span class="fu">plot</span>(linear_model_flat_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb69-644"><a href="#cb69-644"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"flat prior"</span>)</span>
<span id="cb69-645"><a href="#cb69-645"></a></span>
<span id="cb69-646"><a href="#cb69-646"></a><span class="co">#put desired priors into here</span></span>
<span id="cb69-647"><a href="#cb69-647"></a><span class="fu">grid.arrange</span>(pplot_normal_sd, pplot_normal_loc, pplot_default, pplot_flat, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>) </span>
<span id="cb69-648"><a href="#cb69-648"></a><span class="in">```</span></span>
<span id="cb69-649"><a href="#cb69-649"></a></span>
<span id="cb69-652"><a href="#cb69-652"></a><span class="in">```{r}</span></span>
<span id="cb69-653"><a href="#cb69-653"></a><span class="co">#| label: Noninear model - Prior sensititivy analysis</span></span>
<span id="cb69-654"><a href="#cb69-654"></a><span class="co">#normal prior</span></span>
<span id="cb69-655"><a href="#cb69-655"></a>nonlinear_model_normal_prior <span class="ot">&lt;-</span> <span class="fu">stan_gamm4</span>(</span>
<span id="cb69-656"><a href="#cb69-656"></a>  formula_nonlinear, <span class="at">data =</span> cath,</span>
<span id="cb69-657"><a href="#cb69-657"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-658"><a href="#cb69-658"></a>  <span class="at">prior =</span> normal_prior, <span class="at">prior_intercept =</span> normal_prior,</span>
<span id="cb69-659"><a href="#cb69-659"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb69-660"><a href="#cb69-660"></a>)</span>
<span id="cb69-661"><a href="#cb69-661"></a></span>
<span id="cb69-662"><a href="#cb69-662"></a><span class="co">#default prior</span></span>
<span id="cb69-663"><a href="#cb69-663"></a>nonlinear_model_default_prior <span class="ot">&lt;-</span> <span class="fu">stan_gamm4</span>(</span>
<span id="cb69-664"><a href="#cb69-664"></a>  formula_nonlinear, <span class="at">data =</span> cath,</span>
<span id="cb69-665"><a href="#cb69-665"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-666"><a href="#cb69-666"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb69-667"><a href="#cb69-667"></a>)</span>
<span id="cb69-668"><a href="#cb69-668"></a></span>
<span id="cb69-669"><a href="#cb69-669"></a><span class="co">#cauchy prior</span></span>
<span id="cb69-670"><a href="#cb69-670"></a>nonlinear_model_cauchy_prior <span class="ot">&lt;-</span> <span class="fu">stan_gamm4</span>(</span>
<span id="cb69-671"><a href="#cb69-671"></a>  formula_nonlinear, <span class="at">data =</span> cath,</span>
<span id="cb69-672"><a href="#cb69-672"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb69-673"><a href="#cb69-673"></a>  <span class="at">prior =</span> cauchy_prior, <span class="at">prior_intercept =</span> cauchy_prior,</span>
<span id="cb69-674"><a href="#cb69-674"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb69-675"><a href="#cb69-675"></a>)</span>
<span id="cb69-676"><a href="#cb69-676"></a><span class="in">```</span></span>
<span id="cb69-677"><a href="#cb69-677"></a></span>
<span id="cb69-678"><a href="#cb69-678"></a><span class="in">```{r, fig.height=10}</span></span>
<span id="cb69-679"><a href="#cb69-679"></a><span class="co">#| label: Nonlinear model - Plotting prior sensititivy</span></span>
<span id="cb69-680"><a href="#cb69-680"></a>nonlinear_pplot_normal <span class="ot">&lt;-</span> <span class="fu">plot</span>(nonlinear_model_normal_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-681"><a href="#cb69-681"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Normal prior"</span>)</span>
<span id="cb69-682"><a href="#cb69-682"></a></span>
<span id="cb69-683"><a href="#cb69-683"></a>nonlinear_pplot_default <span class="ot">&lt;-</span> <span class="fu">plot</span>(nonlinear_model_default_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-684"><a href="#cb69-684"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Default prior"</span>)</span>
<span id="cb69-685"><a href="#cb69-685"></a></span>
<span id="cb69-686"><a href="#cb69-686"></a>nonlinear_pplot_cauchy <span class="ot">&lt;-</span> <span class="fu">plot</span>(nonlinear_model_cauchy_prior, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-687"><a href="#cb69-687"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cauchy prior"</span>)</span>
<span id="cb69-688"><a href="#cb69-688"></a></span>
<span id="cb69-689"><a href="#cb69-689"></a>pplot_nonlinear <span class="ot">&lt;-</span> <span class="fu">plot</span>(model_nonlinear, <span class="st">"areas"</span>, <span class="at">prob =</span> <span class="fl">0.95</span>, <span class="at">prob_outer =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-690"><a href="#cb69-690"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model prior"</span>)</span>
<span id="cb69-691"><a href="#cb69-691"></a></span>
<span id="cb69-692"><a href="#cb69-692"></a><span class="fu">grid.arrange</span>(pplot_nonlinear, nonlinear_pplot_normal, nonlinear_pplot_default, nonlinear_pplot_cauchy, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>) </span>
<span id="cb69-693"><a href="#cb69-693"></a><span class="in">```</span></span>
<span id="cb69-694"><a href="#cb69-694"></a></span>
<span id="cb69-697"><a href="#cb69-697"></a><span class="in">```{r}</span></span>
<span id="cb69-698"><a href="#cb69-698"></a><span class="in">```</span></span>
<span id="cb69-699"><a href="#cb69-699"></a></span>
<span id="cb69-700"><a href="#cb69-700"></a><span class="fu"># Discussion</span></span>
<span id="cb69-701"><a href="#cb69-701"></a></span>
<span id="cb69-702"><a href="#cb69-702"></a>The scope of this report was to implement two Bayesian models able to predict the probability of significant coronary </span>
<span id="cb69-703"><a href="#cb69-703"></a>disease among patients. The models were implemented Bayesian logistic regression with both a linear and a non-linear </span>
<span id="cb69-704"><a href="#cb69-704"></a>approach. The results were two Stan models of equal classification accuracy. </span>
<span id="cb69-705"><a href="#cb69-705"></a></span>
<span id="cb69-706"><a href="#cb69-706"></a>With classification accuracies of 0.75 (linear) and 0.76 (non-linear), both models performed adequately when it came </span>
<span id="cb69-707"><a href="#cb69-707"></a>to predicting the pervalance of significant coronary disease. The results indicate that both models outperform the baseline model, </span>
<span id="cb69-708"><a href="#cb69-708"></a>with the nonlinear model slightly surpassing the linear model in terms of predictive performance. </span>
<span id="cb69-709"><a href="#cb69-709"></a></span>
<span id="cb69-710"><a href="#cb69-710"></a>There is still room for improvement when it comes to the predictive performance of the models. The problem here may lie in the</span>
<span id="cb69-711"><a href="#cb69-711"></a>explanatory variables being to general when it comes to predicting a certain diseases. To further improve the predictive performance</span>
<span id="cb69-712"><a href="#cb69-712"></a>of the model, new explanatory variables may have to be introduced. Family history, blood pressure, and smoking status are all possible </span>
<span id="cb69-713"><a href="#cb69-713"></a>explanatory variables closely related to cardiovascular health that could help improve model performance.</span>
<span id="cb69-714"><a href="#cb69-714"></a></span>
<span id="cb69-715"><a href="#cb69-715"></a>In conclusion, </span>
<span id="cb69-716"><a href="#cb69-716"></a></span>
<span id="cb69-717"><a href="#cb69-717"></a><span class="fu"># Lessons Learned</span></span>
<span id="cb69-718"><a href="#cb69-718"></a></span>
<span id="cb69-719"><a href="#cb69-719"></a></span>
<span id="cb69-720"><a href="#cb69-720"></a></span>
<span id="cb69-721"><a href="#cb69-721"></a><span class="fu"># References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>